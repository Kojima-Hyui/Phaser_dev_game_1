import{r as j,g as q}from"./phaser-Czz4FBZH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var J=j();const n=q(J);class Q extends n.Scene{constructor(){super({key:"BootScene"})}preload(){}create(){this.scene.start("GameScene"),this.scene.launch("UIScene")}}const B=1280,C=720,T={BACKGROUND:657940,PLAYER:65535,ENEMY:16711782,BULLET:65280,HEALTH_BAR:16711782,HEALTH_BAR_BG:3355443,WALL:4868698,WALL_OUTLINE:9079466},S={SPEED:250,SIZE:20,MAX_HEALTH:100,INITIAL_LEVEL:1,EXP_TO_NEXT_LEVEL_BASE:100,EXP_MULTIPLIER:1.5,LEVEL_UP_HP_GAIN:20,LEVEL_UP_DAMAGE_MULTIPLIER:.1,LEVEL_UP_SPEED_GAIN:10},k={SPAWN_DISTANCE:400,SHOOT_RANGE:350,SHOOT_COOLDOWN:1500};var u=(r=>(r.CHASER="chaser",r.SHOOTER="shooter",r.SPEEDY="speedy",r.TANK="tank",r.BOSS="boss",r))(u||{});const _={chaser:{speed:100,health:30,damage:10,size:16,color:16711782,score:10},shooter:{speed:60,health:25,damage:8,size:14,color:16737792,score:15},speedy:{speed:180,health:15,damage:5,size:12,color:16776960,score:20},tank:{speed:50,health:80,damage:15,size:24,color:16711935,score:30},boss:{speed:80,health:500,damage:25,size:48,color:16711680,score:200}},R={SIZE:4,DAMAGE:15,LIFETIME:2e3};var y=(r=>(r.PISTOL="pistol",r.SHOTGUN="shotgun",r.RIFLE="rifle",r.SNIPER="sniper",r.LASER="laser",r.BEAM="beam",r.ROCKET_LAUNCHER="rocket_launcher",r))(y||{});const ee={pistol:{name:"Pistol",damage:15,fireRate:200,bulletSpeed:500,bulletSize:4,bulletCount:1,spread:0,penetration:!1,color:65280,explosionRadius:0},shotgun:{name:"Shotgun",damage:8,fireRate:600,bulletSpeed:400,bulletSize:3,bulletCount:5,spread:.3,penetration:!1,color:16737792,explosionRadius:0},rifle:{name:"Rifle",damage:12,fireRate:100,bulletSpeed:600,bulletSize:3,bulletCount:1,spread:0,penetration:!1,color:65535,explosionRadius:0},sniper:{name:"Sniper",damage:50,fireRate:1e3,bulletSpeed:800,bulletSize:5,bulletCount:1,spread:0,penetration:!0,color:16711935,explosionRadius:0},laser:{name:"Laser",damage:20,fireRate:150,bulletSpeed:700,bulletSize:4,bulletCount:1,spread:0,penetration:!0,color:16711782,explosionRadius:0},beam:{name:"Beam",damage:5,fireRate:50,bulletSpeed:900,bulletSize:2,bulletCount:1,spread:0,penetration:!0,color:65450,explosionRadius:0},rocket_launcher:{name:"Rocket Launcher",damage:40,fireRate:1200,bulletSpeed:350,bulletSize:8,bulletCount:1,spread:0,penetration:!1,color:16729088,explosionRadius:60}};var v=(r=>(r.SPEED_BOOST="speed_boost",r.DAMAGE_UP="damage_up",r.MAX_HP_UP="max_hp_up",r.FIRE_RATE_UP="fire_rate_up",r.ARMOR="armor",r.HEALTH_REGEN="health_regen",r.MULTI_SHOT="multi_shot",r.MAGNET="magnet",r))(v||{});const A={speed_boost:{name:"Speed Boost",description:"Increases movement speed",effect:30,color:16776960,dropChance:.15},damage_up:{name:"Damage Up",description:"Increases weapon damage",effect:.2,color:16711782,dropChance:.15},max_hp_up:{name:"Max HP Up",description:"Increases maximum health",effect:30,color:65280,dropChance:.12},fire_rate_up:{name:"Fire Rate Up",description:"Increases fire rate",effect:.15,color:65535,dropChance:.1},armor:{name:"Armor",description:"Reduces damage taken",effect:.1,color:11184810,dropChance:.08},health_regen:{name:"Health Regen",description:"Instantly restores HP",effect:40,color:65416,dropChance:.1},multi_shot:{name:"Multi Shot",description:"Adds +1 bullet to all weapons",effect:1,color:16711850,dropChance:.06},magnet:{name:"Magnet",description:"Increases pickup range",effect:100,color:6711039,dropChance:.08}},I={INITIAL_ENEMY_COUNT:8,DEBUG_MODE:!1,CREDIT_DROP_CHANCE:.3},G={CREDIT_VALUE:5,CREDIT_COLOR:16776960},d={WIDTH:2400,HEIGHT:1600,WALL_COUNT:30,WALL_MIN_SIZE:40,WALL_MAX_SIZE:120,SAFE_ZONE_RADIUS:300},H={SP_PER_LEVEL:1,EXP_FOR_BONUS_SP:500};var E=(r=>(r.POWER_SHOT="power_shot",r.RAPID_FIRE="rapid_fire",r.PIERCING_ROUNDS="piercing_rounds",r.EXPLOSIVE_ROUNDS="explosive_rounds",r.MULTI_SHOT="multi_shot",r.VITALITY="vitality",r.REGENERATION="regeneration",r.ARMOR_PLATING="armor_plating",r.EVASION="evasion",r.SPEED_BOOST="speed_boost",r.MAGNETISM="magnetism",r.LUCKY="lucky",r.EXP_BOOST="exp_boost",r))(E||{}),P=(r=>(r.OFFENSE="offense",r.DEFENSE="defense",r.UTILITY="utility",r))(P||{});const L={power_shot:{name:"Power Shot",description:"Increases weapon damage by 10% per level",category:"offense",maxLevel:5,baseCost:1,costPerLevel:1,effectPerLevel:.1,color:16729156},rapid_fire:{name:"Rapid Fire",description:"Increases fire rate by 8% per level",category:"offense",maxLevel:5,baseCost:1,costPerLevel:1,effectPerLevel:.08,color:16746496},piercing_rounds:{name:"Piercing Rounds",description:"Adds +1 penetration hit per level",category:"offense",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:1,color:11141375},explosive_rounds:{name:"Explosive Rounds",description:"Increases explosion radius by 15% per level",category:"offense",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:.15,color:16729088},multi_shot:{name:"Multi Shot",description:"Adds +1 bullet per level",category:"offense",maxLevel:3,baseCost:3,costPerLevel:3,effectPerLevel:1,color:16711850},vitality:{name:"Vitality",description:"Increases max HP by 20 per level",category:"defense",maxLevel:5,baseCost:1,costPerLevel:1,effectPerLevel:20,color:65280},regeneration:{name:"Regeneration",description:"Recovers 1 HP per second per level",category:"defense",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:1,color:65416},armor_plating:{name:"Armor Plating",description:"Reduces damage taken by 5% per level",category:"defense",maxLevel:5,baseCost:1,costPerLevel:1,effectPerLevel:.05,color:8947848},evasion:{name:"Evasion",description:"5% chance to dodge attacks per level",category:"defense",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:.05,color:43775},speed_boost:{name:"Speed Boost",description:"Increases movement speed by 15 per level",category:"utility",maxLevel:5,baseCost:1,costPerLevel:1,effectPerLevel:15,color:16776960},magnetism:{name:"Magnetism",description:"Increases pickup range by 50px per level",category:"utility",maxLevel:3,baseCost:1,costPerLevel:1,effectPerLevel:50,color:6711039},lucky:{name:"Lucky",description:"Increases item drop rate by 5% per level",category:"utility",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:.05,color:16755200},exp_boost:{name:"EXP Boost",description:"Increases EXP gain by 10% per level",category:"utility",maxLevel:3,baseCost:2,costPerLevel:2,effectPerLevel:.1,color:11141375}};class W extends n.GameObjects.Graphics{constructor(e,t,i,s,a,o,h,p,l,c){super(e),this.hitCount=0,this.maxHits=1,this.x=t,this.y=i,this.damage=o!==void 0?o:R.DAMAGE,this.bulletSize=h!==void 0?h:R.SIZE,this.penetration=l!==void 0?l:!1,this.explosionRadius=c!==void 0?c:0,this.penetration&&(this.maxHits=3);const f=p!==void 0?p:T.BULLET;this.fillStyle(f,1),this.fillCircle(0,0,this.bulletSize),this.penetration&&(this.lineStyle(2,f,.5),this.strokeCircle(0,0,this.bulletSize+2)),e.add.existing(this),e.physics.add.existing(this),this.body.setVelocity(s,a),this.body.setCircle(this.bulletSize),this.lifeTimer=e.time.delayedCall(R.LIFETIME,()=>{this.destroy()})}onHit(){return this.hitCount++,!this.penetration||this.hitCount>=this.maxHits?(this.destroy(),!0):!1}destroy(e){this.lifeTimer&&this.lifeTimer.destroy(),super.destroy(e)}}class U{constructor(e,t){this.lastFireTime=0,this.scene=e,this.type=t,this.config=ee[t],this.bullets=e.add.group({classType:W,runChildUpdate:!1})}canFire(e){return e-this.lastFireTime>=this.config.fireRate}fire(e,t,i,s,a=0){const o=this.scene.time.now;if(!this.canFire(o))return;this.lastFireTime=o;const h=n.Math.Angle.Between(e,t,i,s),p=this.config.bulletCount+a;for(let l=0;l<p;l++){let c=h;if(p>1){const x=(this.config.spread>0?this.config.spread:.15)*(l-(p-1)/2);c+=x}const f=Math.cos(c)*this.config.bulletSpeed,g=Math.sin(c)*this.config.bulletSpeed,w=new W(this.scene,e,t,f,g,this.config.damage,this.config.bulletSize,this.config.color,this.config.penetration,this.config.explosionRadius);this.bullets.add(w)}}getBullets(){return this.bullets}destroy(){this.bullets.clear(!0,!0)}}class te extends n.GameObjects.Graphics{constructor(e,t,i){super(e),this.x=t,this.y=i,this.health=S.MAX_HEALTH,this.maxHealth=S.MAX_HEALTH,this.level=S.INITIAL_LEVEL,this.exp=0,this.expToNextLevel=S.EXP_TO_NEXT_LEVEL_BASE,this.speed=S.SPEED,this.baseDamage=15,this.damageMultiplier=1,this.drawPlayer(),e.add.existing(this),e.physics.add.existing(this),this.body.setCollideWorldBounds(!0),this.body.setSize(S.SIZE*2,S.SIZE*2),this.body.setOffset(-20,-20),this.weapons=new Map,this.unlockedWeapons=[y.PISTOL];const s=new U(e,y.PISTOL);this.weapons.set(y.PISTOL,s),this.currentWeapon=s,this.items=[],this.speedBonus=0,this.damageBonus=0,this.fireRateBonus=0,this.armor=0,this.extraBulletCount=0,this.magnetRange=0,this.skillPoints=0,this.totalExp=0,this.lastBonusSPExp=0,this.skillLevels=new Map,this.skillDamageBonus=0,this.skillFireRateBonus=0,this.skillArmorBonus=0,this.skillSpeedBonus=0,this.skillExtraBullets=0,this.skillMagnetBonus=0,this.skillExpBonus=0,this.skillDropBonus=0,this.skillRegenRate=0,this.skillEvasion=0,this.skillPenetrationBonus=0,this.skillExplosionBonus=0,this.regenTimer=0}drawPlayer(){this.clear(),this.fillStyle(T.PLAYER,1),this.lineStyle(2,T.PLAYER,1),this.beginPath(),this.moveTo(0,-20),this.lineTo(-20,S.SIZE),this.lineTo(S.SIZE,S.SIZE),this.closePath(),this.fillPath(),this.strokePath()}update(e,t){let i=0,s=0;e.left.isDown||t.a.isDown?i=-this.speed:(e.right.isDown||t.d.isDown)&&(i=this.speed),e.up.isDown||t.w.isDown?s=-this.speed:(e.down.isDown||t.s.isDown)&&(s=this.speed),i!==0&&s!==0&&(i*=.707,s*=.707),this.body.setVelocity(i,s)}aimAndRotate(e){const t=n.Math.Angle.Between(this.x,this.y,e.worldX,e.worldY);this.rotation=t+Math.PI/2}shoot(e){this.currentWeapon.fire(this.x,this.y,e.worldX,e.worldY,this.getTotalExtraBullets())}getBullets(){return this.currentWeapon.getBullets()}switchWeapon(e){if(!this.unlockedWeapons.includes(e))return!1;if(!this.weapons.has(e)){const t=new U(this.scene,e);this.weapons.set(e,t)}return this.currentWeapon=this.weapons.get(e),!0}unlockWeapon(e){this.unlockedWeapons.includes(e)||this.unlockedWeapons.push(e)}getCurrentWeapon(){return this.currentWeapon}getUnlockedWeapons(){return this.unlockedWeapons}pickupItem(e){this.items.push(e),this.applyItemEffect(e)}applyItemEffect(e){const t=A[e];switch(e){case v.SPEED_BOOST:this.speedBonus+=t.effect,this.speed+=t.effect;break;case v.DAMAGE_UP:this.damageBonus+=t.effect,this.damageMultiplier+=t.effect;break;case v.MAX_HP_UP:this.maxHealth+=t.effect,this.health+=t.effect;break;case v.FIRE_RATE_UP:this.fireRateBonus+=t.effect;break;case v.ARMOR:this.armor+=t.effect,this.armor=Math.min(this.armor,.5);break;case v.HEALTH_REGEN:this.health=Math.min(this.health+t.effect,this.maxHealth);break;case v.MULTI_SHOT:this.extraBulletCount+=t.effect;break;case v.MAGNET:this.magnetRange+=t.effect;break}}getItems(){return this.items}onDeath(){console.log("Player died!")}getHealthPercentage(){return this.health/this.maxHealth}gainExp(e){const t=Math.floor(e*(1+this.skillExpBonus));for(this.exp+=t,this.totalExp+=t;this.totalExp>=this.lastBonusSPExp+H.EXP_FOR_BONUS_SP;)this.skillPoints+=1,this.lastBonusSPExp+=H.EXP_FOR_BONUS_SP,this.showSPGainEffect();for(;this.exp>=this.expToNextLevel;)this.levelUp()}levelUp(){this.exp-=this.expToNextLevel,this.level++,this.expToNextLevel=Math.floor(S.EXP_TO_NEXT_LEVEL_BASE*Math.pow(S.EXP_MULTIPLIER,this.level-1)),this.maxHealth+=S.LEVEL_UP_HP_GAIN,this.health=this.maxHealth,this.damageMultiplier+=S.LEVEL_UP_DAMAGE_MULTIPLIER,this.speed+=S.LEVEL_UP_SPEED_GAIN,this.skillPoints+=H.SP_PER_LEVEL,this.showLevelUpEffect(),console.log(`Level Up! Now Level ${this.level}, SP: ${this.skillPoints}`)}showLevelUpEffect(){this.scene.tweens.add({targets:this,scale:1.3,alpha:.7,duration:200,yoyo:!0,repeat:2});const e=this.scene.add.text(this.x,this.y-50,"LEVEL UP!",{fontSize:"24px",color:"#00ffff",fontStyle:"bold"});e.setOrigin(.5),this.scene.tweens.add({targets:e,y:e.y-30,alpha:0,duration:1e3,onComplete:()=>{e.destroy()}})}getExpPercentage(){return this.exp/this.expToNextLevel}getCurrentDamage(){return Math.floor(this.baseDamage*this.damageMultiplier)}showSPGainEffect(){const e=this.scene.add.text(this.x,this.y-70,"+1 SP",{fontSize:"20px",color:"#ffaa00",fontStyle:"bold"});e.setOrigin(.5),this.scene.tweens.add({targets:e,y:e.y-30,alpha:0,duration:1e3,onComplete:()=>{e.destroy()}})}getSkillLevel(e){return this.skillLevels.get(e)||0}upgradeSkill(e){const t=L[e],i=this.getSkillLevel(e);if(i>=t.maxLevel)return!1;const s=t.baseCost+i*t.costPerLevel;return this.skillPoints<s?!1:(this.skillPoints-=s,this.skillLevels.set(e,i+1),this.recalculateSkillEffects(),!0)}getSkillCost(e){const t=L[e],i=this.getSkillLevel(e);return t.baseCost+i*t.costPerLevel}recalculateSkillEffects(){this.skillDamageBonus=0,this.skillFireRateBonus=0,this.skillArmorBonus=0,this.skillSpeedBonus=0,this.skillExtraBullets=0,this.skillMagnetBonus=0,this.skillExpBonus=0,this.skillDropBonus=0,this.skillRegenRate=0,this.skillEvasion=0,this.skillPenetrationBonus=0,this.skillExplosionBonus=0,this.skillLevels.forEach((e,t)=>{const i=L[t],s=i.effectPerLevel*e;switch(t){case E.POWER_SHOT:this.skillDamageBonus=s;break;case E.RAPID_FIRE:this.skillFireRateBonus=s;break;case E.PIERCING_ROUNDS:this.skillPenetrationBonus=s;break;case E.EXPLOSIVE_ROUNDS:this.skillExplosionBonus=s;break;case E.MULTI_SHOT:this.skillExtraBullets=s;break;case E.VITALITY:const a=s-i.effectPerLevel*(e-1);a>0&&(this.maxHealth+=a,this.health+=a);break;case E.REGENERATION:this.skillRegenRate=s;break;case E.ARMOR_PLATING:this.skillArmorBonus=s;break;case E.EVASION:this.skillEvasion=s;break;case E.SPEED_BOOST:this.skillSpeedBonus=s;break;case E.MAGNETISM:this.skillMagnetBonus=s;break;case E.LUCKY:this.skillDropBonus=s;break;case E.EXP_BOOST:this.skillExpBonus=s;break}})}updateRegen(e){this.skillRegenRate>0&&this.health<this.maxHealth&&(this.regenTimer+=e,this.regenTimer>=1e3&&(this.health=Math.min(this.health+this.skillRegenRate,this.maxHealth),this.regenTimer=0))}takeDamage(e){if(this.skillEvasion>0&&Math.random()<this.skillEvasion)return this.showDodgeEffect(),!1;const t=Math.min(this.armor+this.skillArmorBonus,.75),i=e*(1-t);return this.health=Math.max(0,this.health-i),this.scene.tweens.add({targets:this,alpha:.5,duration:100,yoyo:!0,repeat:2}),this.health<=0&&this.onDeath(),!0}showDodgeEffect(){const e=this.scene.add.text(this.x,this.y-30,"DODGE!",{fontSize:"16px",color:"#00aaff",fontStyle:"bold"});e.setOrigin(.5),this.scene.tweens.add({targets:e,y:e.y-20,alpha:0,duration:500,onComplete:()=>{e.destroy()}})}getStats(){return{health:this.health,maxHealth:this.maxHealth,speed:this.speed+this.skillSpeedBonus,damageMultiplier:this.damageMultiplier+this.skillDamageBonus,armor:Math.min(this.armor+this.skillArmorBonus,.75),evasion:this.skillEvasion,magnetRange:this.magnetRange+this.skillMagnetBonus,extraBullets:this.extraBulletCount+this.skillExtraBullets,expBonus:this.skillExpBonus,dropBonus:this.skillDropBonus,regenRate:this.skillRegenRate,fireRateBonus:this.skillFireRateBonus,penetrationBonus:this.skillPenetrationBonus,explosionBonus:this.skillExplosionBonus}}getAllSkillLevels(){return this.skillLevels}getDropBonus(){return this.skillDropBonus}getTotalExtraBullets(){return this.extraBulletCount+this.skillExtraBullets}getEffectiveSpeed(){return this.speed+this.skillSpeedBonus}getEffectiveMagnetRange(){return this.magnetRange+this.skillMagnetBonus}}class M extends n.GameObjects.Graphics{constructor(e,t,i,s,a,o){super(e),this.x=t,this.y=i,this.damage=o,this.fillStyle(T.ENEMY,1),this.fillCircle(0,0,5),e.add.existing(this),e.physics.add.existing(this),this.body.setVelocity(s,a),this.body.setCircle(5),this.lifeTimer=e.time.delayedCall(3e3,()=>{this.destroy()})}destroy(e){this.lifeTimer&&this.lifeTimer.destroy(),super.destroy(e)}}class V extends n.GameObjects.Graphics{constructor(e,t,i,s,a=u.CHASER){super(e),this.lastShootTime=0,this.x=t,this.y=i,this.player=s,this.enemyType=a;const o=_[a];this.speed=o.speed,this.health=o.health,this.maxHealth=o.health,this.damage=o.damage,this.size=o.size,this.color=o.color,this.scoreValue=o.score,a===u.SHOOTER&&(this.bullets=e.add.group({classType:M,runChildUpdate:!1})),this.drawEnemy(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(this.size*2,this.size*2),this.body.setOffset(-this.size,-this.size)}drawEnemy(){switch(this.clear(),this.fillStyle(this.color,1),this.lineStyle(2,this.color,1),this.enemyType){case u.CHASER:this.fillRect(-this.size,-this.size,this.size*2,this.size*2),this.strokeRect(-this.size,-this.size,this.size*2,this.size*2);break;case u.SHOOTER:this.drawHexagon();break;case u.SPEEDY:this.beginPath(),this.moveTo(0,-this.size),this.lineTo(-this.size,this.size),this.lineTo(this.size,this.size),this.closePath(),this.fillPath(),this.strokePath();break;case u.TANK:this.drawOctagon();break;case u.BOSS:this.drawBoss();break}}drawBoss(){this.fillCircle(0,0,this.size),this.strokeCircle(0,0,this.size),this.lineStyle(3,16776960,1),this.strokeCircle(0,0,this.size*.6),this.lineStyle(4,16776960,1),this.beginPath(),this.moveTo(-this.size*.8,0),this.lineTo(this.size*.8,0),this.moveTo(0,-this.size*.8),this.lineTo(0,this.size*.8),this.strokePath()}drawHexagon(){this.beginPath();for(let e=0;e<6;e++){const t=Math.PI/3*e,i=Math.cos(t)*this.size,s=Math.sin(t)*this.size;e===0?this.moveTo(i,s):this.lineTo(i,s)}this.closePath(),this.fillPath(),this.strokePath()}drawOctagon(){this.beginPath();for(let e=0;e<8;e++){const t=Math.PI/4*e,i=Math.cos(t)*this.size,s=Math.sin(t)*this.size;e===0?this.moveTo(i,s):this.lineTo(i,s)}this.closePath(),this.fillPath(),this.strokePath()}update(){if(!this.player||this.player.health<=0){this.body.setVelocity(0,0);return}const e=n.Math.Distance.Between(this.x,this.y,this.player.x,this.player.y),t=n.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y);switch(this.enemyType){case u.CHASER:case u.SPEEDY:case u.TANK:const i=Math.cos(t)*this.speed,s=Math.sin(t)*this.speed;this.body.setVelocity(i,s),this.rotation=t;break;case u.SHOOTER:if(e>k.SHOOT_RANGE+50){const a=Math.cos(t)*this.speed,o=Math.sin(t)*this.speed;this.body.setVelocity(a,o)}else if(e<k.SHOOT_RANGE-50){const a=-Math.cos(t)*this.speed,o=-Math.sin(t)*this.speed;this.body.setVelocity(a,o)}else this.body.setVelocity(0,0);this.rotation=t,e<=k.SHOOT_RANGE&&this.shoot();break}}shoot(){const e=this.scene.time.now;if(e-this.lastShootTime<k.SHOOT_COOLDOWN)return;this.lastShootTime=e;const t=n.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y),i=Math.cos(t)*300,s=Math.sin(t)*300,a=new M(this.scene,this.x,this.y,i,s,this.damage);this.bullets&&this.bullets.add(a)}getBullets(){return this.bullets}takeDamage(e){this.health-=e,this.scene.tweens.add({targets:this,alpha:.5,duration:50,yoyo:!0}),this.health<=0&&this.destroy()}getDamage(){return this.damage}destroy(e){this.bullets&&this.bullets.clear(!0,!0),super.destroy(e)}}class se extends n.GameObjects.Graphics{constructor(e,t,i,s){super(e),this.enemyType=u.BOSS,this.currentPhase=1,this.lastShootTime=0,this.shootCooldown=800,this.lastDashTime=0,this.dashCooldown=3e3,this.isDashing=!1,this.rotationAngle=0,this.x=t,this.y=i,this.player=s;const a=_[u.BOSS];this.speed=a.speed,this.baseSpeed=a.speed,this.health=a.health,this.maxHealth=a.health,this.damage=a.damage,this.size=a.size,this.color=a.color,this.scoreValue=a.score,this.bullets=e.add.group({classType:M,runChildUpdate:!1}),this.drawBoss(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(this.size*2,this.size*2),this.body.setOffset(-this.size,-this.size)}drawBoss(){this.clear(),this.fillStyle(this.color,1),this.lineStyle(3,this.color,1),this.fillCircle(0,0,this.size),this.strokeCircle(0,0,this.size);let e=16776960;this.currentPhase===2?e=16746496:this.currentPhase===3&&(e=16711680),this.lineStyle(3,e,1),this.strokeCircle(0,0,this.size*.6),this.lineStyle(4,e,1),this.beginPath(),this.moveTo(-this.size*.8,0),this.lineTo(this.size*.8,0),this.moveTo(0,-this.size*.8),this.lineTo(0,this.size*.8),this.strokePath()}update(){if(!this.player||this.player.health<=0){this.body.setVelocity(0,0);return}this.updatePhase();const e=n.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y);switch(this.currentPhase){case 1:this.phase1Behavior(e);break;case 2:this.phase2Behavior(e);break;case 3:this.phase3Behavior(e);break}this.rotation=e,this.rotationAngle+=.02}updatePhase(){const e=this.health/this.maxHealth;let t=this.currentPhase;e>.66?t=1:e>.33?t=2:t=3,t!==this.currentPhase&&(this.currentPhase=t,this.onPhaseChange())}onPhaseChange(){this.drawBoss(),this.scene.tweens.add({targets:this,scale:1.3,duration:200,yoyo:!0,repeat:2}),this.currentPhase===2?(this.speed=this.baseSpeed*1.2,this.shootCooldown=600):this.currentPhase===3&&(this.speed=this.baseSpeed*1.5,this.shootCooldown=400)}phase1Behavior(e){const t=Math.cos(e)*this.speed,i=Math.sin(e)*this.speed;this.body.setVelocity(t,i),this.shootFan(e,3,.3)}phase2Behavior(e){const t=this.scene.time.now;if(!this.isDashing&&t-this.lastDashTime>=this.dashCooldown&&this.startDash(e),!this.isDashing){const i=Math.cos(e)*this.speed*.7,s=Math.sin(e)*this.speed*.7;this.body.setVelocity(i,s)}this.shootRotatingBullets(8)}phase3Behavior(e){const t=Math.cos(e)*this.speed,i=Math.sin(e)*this.speed;this.body.setVelocity(t,i),this.shootRotatingBullets(16)}shootFan(e,t,i){const s=this.scene.time.now;if(!(s-this.lastShootTime<this.shootCooldown)){this.lastShootTime=s;for(let a=0;a<t;a++){const o=e+i*(a-(t-1)/2),h=Math.cos(o)*300,p=Math.sin(o)*300,l=new M(this.scene,this.x,this.y,h,p,this.damage);this.bullets.add(l)}}}shootRotatingBullets(e){const t=this.scene.time.now;if(!(t-this.lastShootTime<this.shootCooldown)){this.lastShootTime=t;for(let i=0;i<e;i++){const s=this.rotationAngle+Math.PI*2/e*i,a=Math.cos(s)*250,o=Math.sin(s)*250,h=new M(this.scene,this.x,this.y,a,o,this.damage);this.bullets.add(h)}}}startDash(e){this.isDashing=!0,this.lastDashTime=this.scene.time.now;const t=this.speed*4,i=Math.cos(e)*t,s=Math.sin(e)*t;this.body.setVelocity(i,s),this.scene.tweens.add({targets:this,alpha:.5,duration:100,yoyo:!0,repeat:3}),this.scene.time.delayedCall(400,()=>{this.isDashing=!1})}getBullets(){return this.bullets}takeDamage(e){this.health-=e,this.scene.tweens.add({targets:this,alpha:.5,duration:50,yoyo:!0}),this.health<=0&&this.onDeath()}onDeath(){this.destroy()}getDamage(){return this.damage}getPhase(){return this.currentPhase}destroy(e){this.bullets&&this.bullets.clear(!0,!0),super.destroy(e)}}class F extends n.GameObjects.Graphics{constructor(e,t,i,s){super(e),this.x=t,this.y=i,this.itemType=s,this.config=A[s],this.drawItem(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(20,20),this.body.setOffset(-10,-10),e.tweens.add({targets:this,y:this.y-10,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,rotation:Math.PI*2,duration:3e3,repeat:-1,ease:"Linear"})}drawItem(){this.clear(),this.fillStyle(this.config.color,1),this.lineStyle(2,this.config.color,1),this.beginPath(),this.moveTo(0,-10),this.lineTo(10,0),this.lineTo(0,10),this.lineTo(-10,0),this.closePath(),this.fillPath(),this.strokePath(),this.fillStyle(16777215,.5),this.beginPath(),this.moveTo(0,-5),this.lineTo(5,0),this.lineTo(0,5),this.lineTo(-5,0),this.closePath(),this.fillPath()}}class X extends n.GameObjects.Graphics{constructor(e,t,i){super(e),this.x=t,this.y=i,this.value=G.CREDIT_VALUE,this.drawCredit(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(16,16),this.body.setOffset(-8,-8),e.tweens.add({targets:this,y:this.y-8,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:this,scale:1.2,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}drawCredit(){this.clear(),this.fillStyle(G.CREDIT_COLOR,1),this.lineStyle(2,16755200,1),this.fillCircle(0,0,8),this.strokeCircle(0,0,8),this.fillStyle(16755200,1),this.fillCircle(0,0,4)}}class b extends n.GameObjects.Graphics{constructor(e,t,i,s,a){super(e),this.x=t,this.y=i,this.wallWidth=s,this.wallHeight=a,this.drawWall(),e.add.existing(this),e.physics.add.existing(this,!0),this.body.setSize(s,a),this.body.setOffset(-s/2,-a/2)}drawWall(){this.clear(),this.fillStyle(T.WALL,1),this.fillRect(-this.wallWidth/2,-this.wallHeight/2,this.wallWidth,this.wallHeight),this.lineStyle(2,T.WALL_OUTLINE,1),this.strokeRect(-this.wallWidth/2,-this.wallHeight/2,this.wallWidth,this.wallHeight),this.lineStyle(1,T.WALL_OUTLINE,.5),this.beginPath(),this.moveTo(-this.wallWidth/2+5,-this.wallHeight/2+5),this.lineTo(this.wallWidth/2-5,-this.wallHeight/2+5),this.strokePath()}}var O=(r=>(r.OPEN_FIELD="open_field",r.ARENA="arena",r.MAZE="maze",r))(O||{});class ie{constructor(e){this.currentPattern="open_field",this.scene=e,this.walls=e.add.group()}generateMap(e,t,i){if(this.walls.clear(!0,!0),i)this.currentPattern=i;else{const s=Object.values(O);this.currentPattern=n.Utils.Array.GetRandom(s)}switch(this.currentPattern){case"open_field":this.generateOpenField(e,t);break;case"arena":this.generateArena(e,t);break;case"maze":this.generateMaze(e,t);break}return this.createBoundaryWalls(),this.walls}generateOpenField(e,t){for(let i=0;i<d.WALL_COUNT;i++){let s,a,o,h,p=0;const l=50;do if(s=n.Math.Between(100,d.WIDTH-100),a=n.Math.Between(100,d.HEIGHT-100),o=n.Math.Between(d.WALL_MIN_SIZE,d.WALL_MAX_SIZE),h=n.Math.Between(d.WALL_MIN_SIZE,d.WALL_MAX_SIZE),p++,p>=l)break;while(this.isInSafeZone(s,a,e,t));const c=new b(this.scene,s,a,o,h);this.walls.add(c)}}generateArena(e,t){for(let l=150;l<d.WIDTH-150;l+=200)if(!this.isInSafeZone(l,150,e,t)){const c=new b(this.scene,l,150,80,80);this.walls.add(c)}for(let l=150;l<d.WIDTH-150;l+=200)if(!this.isInSafeZone(l,d.HEIGHT-150,e,t)){const c=new b(this.scene,l,d.HEIGHT-150,80,80);this.walls.add(c)}for(let l=350;l<d.HEIGHT-150;l+=200)if(!this.isInSafeZone(150,l,e,t)){const c=new b(this.scene,150,l,80,80);this.walls.add(c)}for(let l=350;l<d.HEIGHT-150;l+=200)if(!this.isInSafeZone(d.WIDTH-150,l,e,t)){const c=new b(this.scene,d.WIDTH-150,l,80,80);this.walls.add(c)}const o=120,h=250,p=[{x:h,y:h},{x:d.WIDTH-h,y:h},{x:h,y:d.HEIGHT-h},{x:d.WIDTH-h,y:d.HEIGHT-h}];for(const l of p)if(!this.isInSafeZone(l.x,l.y,e,t)){const c=new b(this.scene,l.x,l.y,o,o);this.walls.add(c)}}generateMaze(e,t){for(let o=1;o<Math.floor(d.WIDTH/300);o++)for(let h=1;h<Math.floor(d.HEIGHT/300);h++){const p=o*300,l=h*300;if(!this.isInSafeZone(p,l,e,t))if(Math.random()>.5){const c=new b(this.scene,p,l,60,150);this.walls.add(c)}else{const c=new b(this.scene,p,l,150,60);this.walls.add(c)}}}getCurrentPattern(){return this.currentPattern}isInSafeZone(e,t,i,s){return n.Math.Distance.Between(e,t,i,s)<d.SAFE_ZONE_RADIUS}createBoundaryWalls(){const t=new b(this.scene,d.WIDTH/2,25,d.WIDTH,50);this.walls.add(t);const i=new b(this.scene,d.WIDTH/2,d.HEIGHT-50/2,d.WIDTH,50);this.walls.add(i);const s=new b(this.scene,50/2,d.HEIGHT/2,50,d.HEIGHT);this.walls.add(s);const a=new b(this.scene,d.WIDTH-50/2,d.HEIGHT/2,50,d.HEIGHT);this.walls.add(a)}getWalls(){return this.walls}}class ae extends n.Scene{constructor(){super({key:"GameScene"}),this.score=0,this.currentCredits=0,this.totalCredits=0,this.currentBoss=null,this.lastBossSpawnScore=0,this.difficultyLevel=1,this.lastDifficultyScore=0,this.isSkillMenuOpen=!1}create(){this.physics.world.setBounds(0,0,d.WIDTH,d.HEIGHT),this.player=new te(this,d.WIDTH/2,d.HEIGHT/2),this.mapGenerator=new ie(this),this.walls=this.mapGenerator.generateMap(this.player.x,this.player.y),this.cameras.main.setBounds(0,0,d.WIDTH,d.HEIGHT),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setZoom(1),this.enemies=this.add.group({classType:V,runChildUpdate:!0}),this.items=this.add.group({classType:F,runChildUpdate:!1}),this.credits=this.add.group({classType:X,runChildUpdate:!1}),this.loadTotalCredits(),this.spawnEnemies(I.INITIAL_ENEMY_COUNT),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={w:this.input.keyboard.addKey(n.Input.Keyboard.KeyCodes.W),a:this.input.keyboard.addKey(n.Input.Keyboard.KeyCodes.A),s:this.input.keyboard.addKey(n.Input.Keyboard.KeyCodes.S),d:this.input.keyboard.addKey(n.Input.Keyboard.KeyCodes.D)},this.input.keyboard.on("keydown-SPACE",()=>{this.player.shoot(this.input.activePointer)}),this.input.on("pointerdown",()=>{this.player.shoot(this.input.activePointer)}),this.input.keyboard.on("keydown-ONE",()=>this.player.switchWeapon(y.PISTOL)),this.input.keyboard.on("keydown-TWO",()=>this.player.switchWeapon(y.SHOTGUN)),this.input.keyboard.on("keydown-THREE",()=>this.player.switchWeapon(y.RIFLE)),this.input.keyboard.on("keydown-FOUR",()=>this.player.switchWeapon(y.SNIPER)),this.input.keyboard.on("keydown-FIVE",()=>this.player.switchWeapon(y.LASER)),this.input.keyboard.on("keydown-SIX",()=>this.player.switchWeapon(y.BEAM)),this.input.keyboard.on("keydown-SEVEN",()=>this.player.switchWeapon(y.ROCKET_LAUNCHER)),this.player.unlockWeapon(y.SHOTGUN),this.player.unlockWeapon(y.RIFLE),this.player.unlockWeapon(y.SNIPER),this.player.unlockWeapon(y.LASER),this.player.unlockWeapon(y.BEAM),this.player.unlockWeapon(y.ROCKET_LAUNCHER),this.setupCollisions(),this.events.on("updateScore",this.updateScore,this),this.input.keyboard.on("keydown-TAB",e=>{e.preventDefault(),this.toggleSkillMenu()}),this.events.on("skillMenuClosed",()=>{this.isSkillMenuOpen=!1,this.physics.resume()})}update(e,t){this.isSkillMenuOpen||(this.player.update(this.cursors,this.wasd),this.player.aimAndRotate(this.input.activePointer),this.player.updateRegen(t),this.enemies.getLength()<I.INITIAL_ENEMY_COUNT&&!this.currentBoss&&this.spawnEnemies(1),this.currentBoss&&this.currentBoss.active&&(this.currentBoss.update(),this.events.emit("updateBossHealth",{health:this.currentBoss.health,maxHealth:this.currentBoss.maxHealth})),this.score>=this.lastBossSpawnScore+500&&!this.currentBoss&&(this.spawnBoss(),this.lastBossSpawnScore=this.score),this.score>=this.lastDifficultyScore+200&&(this.increaseDifficulty(),this.lastDifficultyScore=this.score),this.applyMagnetEffect(),this.events.emit("updateUI",{health:this.player.health,maxHealth:this.player.maxHealth,score:this.score,level:this.player.level,exp:this.player.exp,expToNextLevel:this.player.expToNextLevel,currentWeapon:this.player.getCurrentWeapon().config.name,credits:this.currentCredits,skillPoints:this.player.skillPoints,totalCredits:this.totalCredits}))}applyMagnetEffect(){const e=this.player.getEffectiveMagnetRange();if(e<=0)return;const t=50+e;this.items.getChildren().forEach(i=>{const s=i,a=n.Math.Distance.Between(this.player.x,this.player.y,s.x,s.y);if(a<t&&a>10){const o=n.Math.Angle.Between(s.x,s.y,this.player.x,this.player.y);s.x+=Math.cos(o)*5,s.y+=Math.sin(o)*5}}),this.credits.getChildren().forEach(i=>{const s=i,a=n.Math.Distance.Between(this.player.x,this.player.y,s.x,s.y);if(a<t&&a>10){const o=n.Math.Angle.Between(s.x,s.y,this.player.x,this.player.y);s.x+=Math.cos(o)*5,s.y+=Math.sin(o)*5}})}setupCollisions(){this.physics.add.collider(this.player,this.walls),this.physics.add.collider(this.enemies,this.walls),this.physics.add.collider(this.player.getBullets(),this.walls,e=>{e.destroy()}),this.physics.add.overlap(this.player.getBullets(),this.enemies,this.bulletHitEnemy,void 0,this),this.physics.add.overlap(this.player,this.enemies,this.playerHitEnemy,void 0,this),this.physics.add.overlap(this.player,this.items,this.playerPickupItem,void 0,this),this.physics.add.overlap(this.player,this.credits,this.playerPickupCredit,void 0,this)}setupEnemyBulletCollisions(e){const t=e.getBullets();t&&(this.physics.add.overlap(this.player,t,this.enemyBulletHitPlayer,void 0,this),this.physics.add.collider(t,this.walls,i=>{i.destroy()}))}bulletHitEnemy(e,t){const i=e,s=t;this.createHitEffect(s.x,s.y),this.showDamageNumber(s.x,s.y,i.damage),s.takeDamage(i.damage),i.explosionRadius>0&&this.createExplosion(i.x,i.y,i.explosionRadius,i.damage),i.onHit(),s.health<=0&&(this.score+=s.scoreValue,this.player.gainExp(s.scoreValue),this.createDeathEffect(s.x,s.y,s.enemyType),this.tryDropItem(s.x,s.y),this.tryDropCredit(s.x,s.y))}createHitEffect(e,t){const i=this.add.graphics();i.fillStyle(16777215,1),i.fillCircle(0,0,5),i.x=e,i.y=t,this.tweens.add({targets:i,scale:2,alpha:0,duration:150,onComplete:()=>{i.destroy()}})}showDamageNumber(e,t,i){const s=this.add.text(e,t-20,Math.floor(i).toString(),{fontSize:"18px",color:"#ffffff",fontStyle:"bold"});s.setOrigin(.5),this.tweens.add({targets:s,y:s.y-40,alpha:0,duration:600,onComplete:()=>{s.destroy()}})}createDeathEffect(e,t,i){var o;const a=((o=_[i])==null?void 0:o.color)||16711782;for(let h=0;h<8;h++){const p=Math.PI*2/8*h,l=this.add.graphics();l.fillStyle(a,1),l.fillCircle(0,0,4),l.x=e,l.y=t;const c=50,f=e+Math.cos(p)*c,g=t+Math.sin(p)*c;this.tweens.add({targets:l,x:f,y:g,alpha:0,scale:.5,duration:300,onComplete:()=>{l.destroy()}})}}createExplosion(e,t,i,s){const a=this.add.graphics();if(a.fillStyle(16729088,.5),a.fillCircle(0,0,i),a.lineStyle(3,16776960,1),a.strokeCircle(0,0,i),a.x=e,a.y=t,this.tweens.add({targets:a,scale:1.5,alpha:0,duration:300,onComplete:()=>{a.destroy()}}),this.enemies.getChildren().forEach(o=>{const h=o,p=n.Math.Distance.Between(e,t,h.x,h.y);if(p<i){const l=1-p/i*.5;h.takeDamage(s*l),this.showDamageNumber(h.x,h.y,s*l),h.health<=0&&(this.score+=h.scoreValue,this.player.gainExp(h.scoreValue),this.createDeathEffect(h.x,h.y,h.enemyType),this.tryDropItem(h.x,h.y),this.tryDropCredit(h.x,h.y))}}),this.currentBoss&&this.currentBoss.active){const o=n.Math.Distance.Between(e,t,this.currentBoss.x,this.currentBoss.y);if(o<i){const h=1-o/i*.5;this.currentBoss.takeDamage(s*h),this.showDamageNumber(this.currentBoss.x,this.currentBoss.y,s*h)}}this.cameras.main.shake(100,.005)}tryDropItem(e,t){const i=Object.values(v),s=this.player.getDropBonus();for(const a of i){const h=A[a].dropChance*(1+s);if(Math.random()<h){const p=new F(this,e,t,a);this.items.add(p);break}}}playerPickupItem(e,t){const i=t;this.player.pickupItem(i.itemType),this.tweens.add({targets:i,alpha:0,scale:1.5,duration:200,onComplete:()=>{i.destroy()}})}enemyBulletHitPlayer(e,t){const i=t;this.player.takeDamage(i.damage),i.destroy(),this.player.health<=0&&this.gameOver()}playerHitEnemy(e,t){const i=t;this.player.takeDamage(i.getDamage()),i.destroy(),this.player.health<=0&&this.gameOver()}spawnEnemies(e){const t=this.getDifficultyMultiplier();for(let i=0;i<e;i++){const s=n.Math.FloatBetween(0,Math.PI*2),a=k.SPAWN_DISTANCE,o=this.player.x+Math.cos(s)*a,h=this.player.y+Math.sin(s)*a,p=n.Math.Clamp(o,50,d.WIDTH-50),l=n.Math.Clamp(h,50,d.HEIGHT-50),c=[u.CHASER,u.SHOOTER,u.SPEEDY,u.TANK],f=n.Utils.Array.GetRandom(c),g=new V(this,p,l,this.player,f);g.health*=t.hpMultiplier,g.maxHealth*=t.hpMultiplier,this.enemies.add(g),f===u.SHOOTER&&this.setupEnemyBulletCollisions(g)}}tryDropCredit(e,t){if(Math.random()<I.CREDIT_DROP_CHANCE){const i=new X(this,e,t);this.credits.add(i)}}playerPickupCredit(e,t){const i=t;this.currentCredits+=i.value,this.totalCredits+=i.value,this.saveTotalCredits(),this.tweens.add({targets:i,y:i.y-30,alpha:0,duration:300,onComplete:()=>{i.destroy()}})}loadTotalCredits(){const e=localStorage.getItem("totalCredits");this.totalCredits=e?parseInt(e):0}saveTotalCredits(){localStorage.setItem("totalCredits",this.totalCredits.toString())}updateScore(e){this.score=e}spawnBoss(){this.walls=this.mapGenerator.generateMap(this.player.x,this.player.y,O.ARENA),this.physics.add.collider(this.player,this.walls),this.physics.add.collider(this.enemies,this.walls),this.physics.add.collider(this.player.getBullets(),this.walls,a=>{a.destroy()});const e=n.Math.FloatBetween(0,Math.PI*2),t=k.SPAWN_DISTANCE,i=n.Math.Clamp(this.player.x+Math.cos(e)*t,100,d.WIDTH-100),s=n.Math.Clamp(this.player.y+Math.sin(e)*t,100,d.HEIGHT-100);this.currentBoss=new se(this,i,s,this.player),this.setupBossBulletCollisions(),this.physics.add.overlap(this.player.getBullets(),this.currentBoss,this.bulletHitBoss,void 0,this),this.physics.add.overlap(this.player,this.currentBoss,this.playerHitBoss,void 0,this),this.physics.add.collider(this.currentBoss,this.walls),this.events.emit("bossSpawned"),this.cameras.main.shake(500,.01)}setupBossBulletCollisions(){if(!this.currentBoss)return;const e=this.currentBoss.getBullets();this.physics.add.overlap(this.player,e,this.enemyBulletHitPlayer,void 0,this),this.physics.add.collider(e,this.walls,t=>{t.destroy()})}bulletHitBoss(e,t){const i=e;!this.currentBoss||!this.currentBoss.active||(this.createHitEffect(this.currentBoss.x,this.currentBoss.y),this.showDamageNumber(this.currentBoss.x,this.currentBoss.y,i.damage),this.currentBoss.takeDamage(i.damage),i.onHit(),this.currentBoss.health<=0&&this.onBossDefeated())}playerHitBoss(e,t){!this.currentBoss||!this.currentBoss.active||(this.player.takeDamage(this.currentBoss.getDamage()),this.player.health<=0&&this.gameOver())}onBossDefeated(){if(this.currentBoss){this.score+=this.currentBoss.scoreValue,this.player.gainExp(this.currentBoss.scoreValue),this.createBossDeathEffect(this.currentBoss.x,this.currentBoss.y);for(let e=0;e<5;e++){const t=n.Math.Between(-50,50),i=n.Math.Between(-50,50);this.tryDropItem(this.currentBoss.x+t,this.currentBoss.y+i),this.tryDropCredit(this.currentBoss.x+t,this.currentBoss.y+i)}this.events.emit("bossDefeated"),this.currentBoss=null}}createBossDeathEffect(e,t){for(let s=0;s<16;s++){const a=Math.PI*2/16*s,o=this.add.graphics();o.fillStyle(16711680,1),o.fillCircle(0,0,8),o.x=e,o.y=t;const h=100,p=e+Math.cos(a)*h,l=t+Math.sin(a)*h;this.tweens.add({targets:o,x:p,y:l,alpha:0,scale:.3,duration:500,onComplete:()=>{o.destroy()}})}this.cameras.main.shake(300,.02)}increaseDifficulty(){this.difficultyLevel++,console.log(`Difficulty increased to level ${this.difficultyLevel}`)}getDifficultyMultiplier(){return{hpMultiplier:1+(this.difficultyLevel-1)*.1,speedMultiplier:1+(this.difficultyLevel-1)*.05}}gameOver(){console.log("Game Over! Final Score:",this.score),this.physics.pause();const e=this.add.text(B/2,C/2,`GAME OVER
Press R to Restart`,{fontSize:"48px",color:"#ff0066",align:"center"});e.setOrigin(.5),e.setScrollFactor(0);const t=this.add.text(B/2,C/2+80,`Score: ${this.score}`,{fontSize:"32px",color:"#00ffff",align:"center"});t.setOrigin(.5),t.setScrollFactor(0),this.input.keyboard.once("keydown-R",()=>{this.scene.restart()})}toggleSkillMenu(){this.isSkillMenuOpen?(this.scene.stop("SkillMenuScene"),this.isSkillMenuOpen=!1,this.physics.resume()):(this.isSkillMenuOpen=!0,this.physics.pause(),this.scene.launch("SkillMenuScene",{player:this.player}))}}class le extends n.Scene{constructor(){super({key:"UIScene",active:!1}),this.bossActive=!1}create(){this.healthBarBg=this.add.graphics(),this.healthBarBg.fillStyle(T.HEALTH_BAR_BG,1),this.healthBarBg.fillRect(20,20,200,20),this.healthBar=this.add.graphics(),this.healthText=this.add.text(20,45,"HP: 100/100",{fontSize:"16px",color:"#00ffff"}),this.levelText=this.add.text(20,70,"Level: 1",{fontSize:"20px",color:"#ffff00",fontStyle:"bold"}),this.expBarBg=this.add.graphics(),this.expBarBg.fillStyle(T.HEALTH_BAR_BG,1),this.expBarBg.fillRect(20,95,200,15),this.expBar=this.add.graphics(),this.expText=this.add.text(20,115,"EXP: 0/100",{fontSize:"14px",color:"#ffff00"}),this.scoreText=this.add.text(20,140,"Score: 0",{fontSize:"20px",color:"#00ffff"}),this.weaponText=this.add.text(20,170,"Weapon: Pistol",{fontSize:"18px",color:"#00ff00",fontStyle:"bold"}),this.creditText=this.add.text(20,200,"Credits: 0",{fontSize:"16px",color:"#ffff00"}),this.totalCreditText=this.add.text(20,220,"Total Credits: 0",{fontSize:"14px",color:"#ffaa00"}),this.spText=this.add.text(20,245,"SP: 0",{fontSize:"18px",color:"#ffaa00",fontStyle:"bold"}),this.add.text(20,275,"WASD: Move | Mouse: Aim | Space/Click: Shoot | 1-7: Weapon | TAB: Skills",{fontSize:"14px",color:"#666666"}),this.bossHealthBarBg=this.add.graphics(),this.bossHealthBarBg.fillStyle(T.HEALTH_BAR_BG,1),this.bossHealthBarBg.fillRect(B/2-200,50,400,25),this.bossHealthBarBg.setVisible(!1),this.bossHealthBar=this.add.graphics(),this.bossHealthBar.setVisible(!1),this.bossNameText=this.add.text(B/2,30,"CYBER GUARDIAN",{fontSize:"24px",color:"#ff0000",fontStyle:"bold"}),this.bossNameText.setOrigin(.5),this.bossNameText.setVisible(!1),this.warningText=this.add.text(B/2,200,"WARNING",{fontSize:"64px",color:"#ff0000",fontStyle:"bold"}),this.warningText.setOrigin(.5),this.warningText.setVisible(!1);const e=this.scene.get("GameScene");e.events.on("updateUI",this.updateUI,this),e.events.on("bossSpawned",this.onBossSpawned,this),e.events.on("bossDefeated",this.onBossDefeated,this),e.events.on("updateBossHealth",this.updateBossHealth,this)}updateUI(e){const t=e.health/e.maxHealth;this.healthBar.clear(),this.healthBar.fillStyle(T.HEALTH_BAR,1),this.healthBar.fillRect(20,20,200*t,20),this.healthText.setText(`HP: ${Math.max(0,Math.floor(e.health))}/${e.maxHealth}`),this.levelText.setText(`Level: ${e.level}`);const i=e.exp/e.expToNextLevel;this.expBar.clear(),this.expBar.fillStyle(16776960,1),this.expBar.fillRect(20,95,200*i,15),this.expText.setText(`EXP: ${Math.floor(e.exp)}/${e.expToNextLevel}`),this.scoreText.setText(`Score: ${e.score}`),this.weaponText.setText(`Weapon: ${e.currentWeapon}`),this.creditText.setText(`Credits: ${e.credits}`),this.totalCreditText.setText(`Total Credits: ${e.totalCredits}`),this.spText.setText(`SP: ${e.skillPoints}`)}onBossSpawned(){this.bossActive=!0,this.warningText.setVisible(!0),this.warningText.setAlpha(1),this.tweens.add({targets:this.warningText,alpha:0,duration:200,yoyo:!0,repeat:5,onComplete:()=>{this.warningText.setVisible(!1)}}),this.cameras.main.shake(500,.01),this.time.delayedCall(1500,()=>{this.bossHealthBarBg.setVisible(!0),this.bossHealthBar.setVisible(!0),this.bossNameText.setVisible(!0)})}onBossDefeated(){this.bossActive=!1,this.bossHealthBarBg.setVisible(!1),this.bossHealthBar.setVisible(!1),this.bossNameText.setVisible(!1)}updateBossHealth(e){if(!this.bossActive)return;const t=e.health/e.maxHealth;this.bossHealthBar.clear();let i=16711680;t>.66?i=16711680:t>.33?i=16746496:i=16776960,this.bossHealthBar.fillStyle(i,1),this.bossHealthBar.fillRect(B/2-200,50,400*t,25)}}class oe extends n.Scene{constructor(){super({key:"SkillMenuScene"}),this.skillButtons=[],this.statsTexts=[],this.categoryTabs=[],this.currentCategory=P.OFFENSE}init(e){this.player=e.player}create(){this.background=this.add.graphics(),this.background.fillStyle(0,.85),this.background.fillRect(0,0,B,C),this.titleText=this.add.text(B/2,40,"SKILL MENU",{fontSize:"36px",color:"#00ffff",fontStyle:"bold"}),this.titleText.setOrigin(.5),this.spText=this.add.text(B/2,80,`SP: ${this.player.skillPoints}`,{fontSize:"24px",color:"#ffaa00",fontStyle:"bold"}),this.spText.setOrigin(.5),this.closeHint=this.add.text(B/2,C-30,"Press TAB to close",{fontSize:"16px",color:"#666666"}),this.closeHint.setOrigin(.5),this.createCategoryTabs(),this.createStatsPanel(),this.createSkillList(),this.input.keyboard.on("keydown-TAB",()=>{this.closeMenu()}),this.input.keyboard.on("keydown-ESC",()=>{this.closeMenu()})}createCategoryTabs(){const e=[{type:P.OFFENSE,name:"OFFENSE",color:16729156},{type:P.DEFENSE,name:"DEFENSE",color:4521796},{type:P.UTILITY,name:"UTILITY",color:4474111}],t=150,i=35,s=B/2-e.length*t/2;e.forEach((a,o)=>{const h=s+o*t+t/2,l=this.add.container(h,130),c=this.add.graphics();c.fillStyle(a.type===this.currentCategory?a.color:3355443,1),c.fillRoundedRect(-t/2,-i/2,t,i,5),l.add(c);const f=this.add.text(0,0,a.name,{fontSize:"16px",color:"#ffffff",fontStyle:"bold"});f.setOrigin(.5),l.add(f),l.setSize(t,i),l.setInteractive({useHandCursor:!0}),l.on("pointerdown",()=>{this.currentCategory=a.type,this.refreshCategoryTabs(),this.refreshSkillList()}),l.on("pointerover",()=>{c.clear(),c.fillStyle(a.color,.8),c.fillRoundedRect(-t/2,-i/2,t,i,5)}),l.on("pointerout",()=>{c.clear(),c.fillStyle(a.type===this.currentCategory?a.color:3355443,1),c.fillRoundedRect(-t/2,-i/2,t,i,5)}),this.categoryTabs.push(l)})}refreshCategoryTabs(){const e=[{type:P.OFFENSE,color:16729156},{type:P.DEFENSE,color:4521796},{type:P.UTILITY,color:4474111}];this.categoryTabs.forEach((t,i)=>{const s=t.getAt(0),a=e[i];s.clear(),s.fillStyle(a.type===this.currentCategory?a.color:3355443,1),s.fillRoundedRect(-75,-17.5,150,35,5)})}createStatsPanel(){const s=this.add.graphics();s.fillStyle(1710638,1),s.lineStyle(2,65535,.5),s.fillRoundedRect(40,170,280,320,10),s.strokeRoundedRect(40,170,280,320,10),this.add.text(50,180,"STATS",{fontSize:"20px",color:"#00ffff",fontStyle:"bold"});const a=this.player.getStats();[{label:"Level",value:this.player.level.toString(),color:"#ffffff"},{label:"Total EXP",value:this.player.totalExp.toString(),color:"#ffff00"},{label:"HP",value:`${Math.floor(a.health)}/${a.maxHealth}`,color:"#00ff00"},{label:"Speed",value:Math.floor(a.speed).toString(),color:"#ffff00"},{label:"Damage",value:`${Math.floor(a.damageMultiplier*100)}%`,color:"#ff4444"},{label:"Armor",value:`${Math.floor(a.armor*100)}%`,color:"#888888"},{label:"Evasion",value:`${Math.floor(a.evasion*100)}%`,color:"#00aaff"},{label:"Extra Bullets",value:`+${a.extraBullets}`,color:"#ff00aa"},{label:"Magnet Range",value:`+${a.magnetRange}px`,color:"#6666ff"},{label:"EXP Bonus",value:`+${Math.floor(a.expBonus*100)}%`,color:"#aa00ff"},{label:"Drop Bonus",value:`+${Math.floor(a.dropBonus*100)}%`,color:"#ffaa00"},{label:"HP Regen",value:`${a.regenRate}/s`,color:"#00ff88"}].forEach((h,p)=>{const l=215+p*22,c=this.add.text(50,l,h.label+":",{fontSize:"14px",color:"#aaaaaa"}),f=this.add.text(200,l,h.value,{fontSize:"14px",color:h.color});this.statsTexts.push(c,f)})}createSkillList(){this.refreshSkillList()}refreshSkillList(){this.skillButtons.forEach(h=>h.container.destroy()),this.skillButtons=[];const e=Object.entries(L).filter(([h,p])=>p.category===this.currentCategory).map(([h,p])=>h),t=380,i=180,s=400,a=70,o=10;e.forEach((h,p)=>{const l=L[h],c=this.player.getSkillLevel(h),f=this.player.getSkillCost(h),g=c>=l.maxLevel,w=this.player.skillPoints>=f,D=i+p*(a+o),x=this.add.container(t,D),m=this.add.graphics(),Y=g?17408:w?2763338:1710634;m.fillStyle(Y,1),m.lineStyle(2,l.color,g?1:.5),m.fillRoundedRect(0,0,s,a,8),m.strokeRoundedRect(0,0,s,a,8),x.add(m);const $=this.add.text(15,10,l.name,{fontSize:"18px",color:g?"#00ff00":"#ffffff",fontStyle:"bold"});x.add($);const K=this.add.text(15,35,l.description,{fontSize:"12px",color:"#888888"});x.add(K);const N=this.add.text(s-100,15,`Lv.${c}/${l.maxLevel}`,{fontSize:"16px",color:g?"#00ff00":"#ffffff"});x.add(N);const Z=g?"#00ff00":w?"#ffaa00":"#ff4444",z=this.add.text(s-100,40,g?"MAX":`Cost: ${f} SP`,{fontSize:"14px",color:Z});x.add(z),g||(x.setSize(s,a),x.setInteractive({useHandCursor:w}),x.on("pointerover",()=>{w&&(m.clear(),m.fillStyle(3816026,1),m.lineStyle(2,l.color,1),m.fillRoundedRect(0,0,s,a,8),m.strokeRoundedRect(0,0,s,a,8))}),x.on("pointerout",()=>{m.clear(),m.fillStyle(w?2763338:1710634,1),m.lineStyle(2,l.color,.5),m.fillRoundedRect(0,0,s,a,8),m.strokeRoundedRect(0,0,s,a,8)}),x.on("pointerdown",()=>{w&&this.upgradeSkill(h)})),this.skillButtons.push({container:x,skillType:h,levelText:N,costText:z})})}upgradeSkill(e){this.player.upgradeSkill(e)&&(this.cameras.main.flash(100,255,170,0),this.spText.setText(`SP: ${this.player.skillPoints}`),this.refreshSkillList(),this.refreshStats())}refreshStats(){this.statsTexts.forEach(o=>o.destroy()),this.statsTexts=[];const e=50,t=180,i=22,s=this.player.getStats();[{label:"Level",value:this.player.level.toString(),color:"#ffffff"},{label:"Total EXP",value:this.player.totalExp.toString(),color:"#ffff00"},{label:"HP",value:`${Math.floor(s.health)}/${s.maxHealth}`,color:"#00ff00"},{label:"Speed",value:Math.floor(s.speed).toString(),color:"#ffff00"},{label:"Damage",value:`${Math.floor(s.damageMultiplier*100)}%`,color:"#ff4444"},{label:"Armor",value:`${Math.floor(s.armor*100)}%`,color:"#888888"},{label:"Evasion",value:`${Math.floor(s.evasion*100)}%`,color:"#00aaff"},{label:"Extra Bullets",value:`+${s.extraBullets}`,color:"#ff00aa"},{label:"Magnet Range",value:`+${s.magnetRange}px`,color:"#6666ff"},{label:"EXP Bonus",value:`+${Math.floor(s.expBonus*100)}%`,color:"#aa00ff"},{label:"Drop Bonus",value:`+${Math.floor(s.dropBonus*100)}%`,color:"#ffaa00"},{label:"HP Regen",value:`${s.regenRate}/s`,color:"#00ff88"}].forEach((o,h)=>{const p=t+35+h*i,l=this.add.text(e,p,o.label+":",{fontSize:"14px",color:"#aaaaaa"}),c=this.add.text(e+150,p,o.value,{fontSize:"14px",color:o.color});this.statsTexts.push(l,c)})}closeMenu(){this.scene.get("GameScene").events.emit("skillMenuClosed"),this.scene.stop()}update(){this.spText.setText(`SP: ${this.player.skillPoints}`)}}const he={type:n.AUTO,width:B,height:C,parent:"game-container",backgroundColor:T.BACKGROUND,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:I.DEBUG_MODE}},scene:[Q,ae,le,oe],scale:{mode:n.Scale.FIT,autoCenter:n.Scale.CENTER_BOTH}};new n.Game(he);console.log("サイバーパンク・ローグライトシューター - 起動");console.log("Phaser version:",n.VERSION);
