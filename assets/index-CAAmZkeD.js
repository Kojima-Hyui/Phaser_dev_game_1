import{r as N,g as z}from"./phaser-Czz4FBZH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();var W=N();const r=z(W);class G extends r.Scene{constructor(){super({key:"BootScene"})}preload(){}create(){this.scene.start("GameScene"),this.scene.launch("UIScene")}}const w=1280,C=720,m={BACKGROUND:657940,PLAYER:65535,ENEMY:16711782,BULLET:65280,HEALTH_BAR:16711782,HEALTH_BAR_BG:3355443,WALL:4868698,WALL_OUTLINE:9079466},y={SPEED:250,SIZE:20,MAX_HEALTH:100,INITIAL_LEVEL:1,EXP_TO_NEXT_LEVEL_BASE:100,EXP_MULTIPLIER:1.5,LEVEL_UP_HP_GAIN:20,LEVEL_UP_DAMAGE_MULTIPLIER:.1,LEVEL_UP_SPEED_GAIN:10},T={SPAWN_DISTANCE:400,SHOOT_RANGE:350,SHOOT_COOLDOWN:1500};var u=(n=>(n.CHASER="chaser",n.SHOOTER="shooter",n.SPEEDY="speedy",n.TANK="tank",n.BOSS="boss",n))(u||{});const I={chaser:{speed:100,health:30,damage:10,size:16,color:16711782,score:10},shooter:{speed:60,health:25,damage:8,size:14,color:16737792,score:15},speedy:{speed:180,health:15,damage:5,size:12,color:16776960,score:20},tank:{speed:50,health:80,damage:15,size:24,color:16711935,score:30},boss:{speed:80,health:500,damage:25,size:48,color:16711680,score:200}},H={SIZE:4,DAMAGE:15,LIFETIME:2e3};var f=(n=>(n.PISTOL="pistol",n.SHOTGUN="shotgun",n.RIFLE="rifle",n.SNIPER="sniper",n.LASER="laser",n.BEAM="beam",n.ROCKET_LAUNCHER="rocket_launcher",n))(f||{});const U={pistol:{name:"Pistol",damage:15,fireRate:200,bulletSpeed:500,bulletSize:4,bulletCount:1,spread:0,penetration:!1,color:65280,explosionRadius:0},shotgun:{name:"Shotgun",damage:8,fireRate:600,bulletSpeed:400,bulletSize:3,bulletCount:5,spread:.3,penetration:!1,color:16737792,explosionRadius:0},rifle:{name:"Rifle",damage:12,fireRate:100,bulletSpeed:600,bulletSize:3,bulletCount:1,spread:0,penetration:!1,color:65535,explosionRadius:0},sniper:{name:"Sniper",damage:50,fireRate:1e3,bulletSpeed:800,bulletSize:5,bulletCount:1,spread:0,penetration:!0,color:16711935,explosionRadius:0},laser:{name:"Laser",damage:20,fireRate:150,bulletSpeed:700,bulletSize:4,bulletCount:1,spread:0,penetration:!0,color:16711782,explosionRadius:0},beam:{name:"Beam",damage:5,fireRate:50,bulletSpeed:900,bulletSize:2,bulletCount:1,spread:0,penetration:!0,color:65450,explosionRadius:0},rocket_launcher:{name:"Rocket Launcher",damage:40,fireRate:1200,bulletSpeed:350,bulletSize:8,bulletCount:1,spread:0,penetration:!1,color:16729088,explosionRadius:60}};var E=(n=>(n.SPEED_BOOST="speed_boost",n.DAMAGE_UP="damage_up",n.MAX_HP_UP="max_hp_up",n.FIRE_RATE_UP="fire_rate_up",n.ARMOR="armor",n.HEALTH_REGEN="health_regen",n.MULTI_SHOT="multi_shot",n.MAGNET="magnet",n))(E||{});const M={speed_boost:{name:"Speed Boost",description:"Increases movement speed",effect:30,color:16776960,dropChance:.15},damage_up:{name:"Damage Up",description:"Increases weapon damage",effect:.2,color:16711782,dropChance:.15},max_hp_up:{name:"Max HP Up",description:"Increases maximum health",effect:30,color:65280,dropChance:.12},fire_rate_up:{name:"Fire Rate Up",description:"Increases fire rate",effect:.15,color:65535,dropChance:.1},armor:{name:"Armor",description:"Reduces damage taken",effect:.1,color:11184810,dropChance:.08},health_regen:{name:"Health Regen",description:"Instantly restores HP",effect:40,color:65416,dropChance:.1},multi_shot:{name:"Multi Shot",description:"Adds +1 bullet to all weapons",effect:1,color:16711850,dropChance:.06},magnet:{name:"Magnet",description:"Increases pickup range",effect:100,color:6711039,dropChance:.08}},B={INITIAL_ENEMY_COUNT:8,DEBUG_MODE:!1,CREDIT_DROP_CHANCE:.3},P={CREDIT_VALUE:5,CREDIT_COLOR:16776960},c={WIDTH:2400,HEIGHT:1600,WALL_COUNT:30,WALL_MIN_SIZE:40,WALL_MAX_SIZE:120,SAFE_ZONE_RADIUS:300};class L extends r.GameObjects.Graphics{constructor(t,e,s,i,a,h,l,d,o,p){super(t),this.hitCount=0,this.maxHits=1,this.x=e,this.y=s,this.damage=h!==void 0?h:H.DAMAGE,this.bulletSize=l!==void 0?l:H.SIZE,this.penetration=o!==void 0?o:!1,this.explosionRadius=p!==void 0?p:0,this.penetration&&(this.maxHits=3);const S=d!==void 0?d:m.BULLET;this.fillStyle(S,1),this.fillCircle(0,0,this.bulletSize),this.penetration&&(this.lineStyle(2,S,.5),this.strokeCircle(0,0,this.bulletSize+2)),t.add.existing(this),t.physics.add.existing(this),this.body.setVelocity(i,a),this.body.setCircle(this.bulletSize),this.lifeTimer=t.time.delayedCall(H.LIFETIME,()=>{this.destroy()})}onHit(){return this.hitCount++,!this.penetration||this.hitCount>=this.maxHits?(this.destroy(),!0):!1}destroy(t){this.lifeTimer&&this.lifeTimer.destroy(),super.destroy(t)}}class _{constructor(t,e){this.lastFireTime=0,this.scene=t,this.type=e,this.config=U[e],this.bullets=t.add.group({classType:L,runChildUpdate:!1})}canFire(t){return t-this.lastFireTime>=this.config.fireRate}fire(t,e,s,i,a=0){const h=this.scene.time.now;if(!this.canFire(h))return;this.lastFireTime=h;const l=r.Math.Angle.Between(t,e,s,i),d=this.config.bulletCount+a;for(let o=0;o<d;o++){let p=l;if(d>1){const k=(this.config.spread>0?this.config.spread:.15)*(o-(d-1)/2);p+=k}const S=Math.cos(p)*this.config.bulletSpeed,x=Math.sin(p)*this.config.bulletSpeed,R=new L(this.scene,t,e,S,x,this.config.damage,this.config.bulletSize,this.config.color,this.config.penetration,this.config.explosionRadius);this.bullets.add(R)}}getBullets(){return this.bullets}destroy(){this.bullets.clear(!0,!0)}}class V extends r.GameObjects.Graphics{constructor(t,e,s){super(t),this.x=e,this.y=s,this.health=y.MAX_HEALTH,this.maxHealth=y.MAX_HEALTH,this.level=y.INITIAL_LEVEL,this.exp=0,this.expToNextLevel=y.EXP_TO_NEXT_LEVEL_BASE,this.speed=y.SPEED,this.baseDamage=15,this.damageMultiplier=1,this.drawPlayer(),t.add.existing(this),t.physics.add.existing(this),this.body.setCollideWorldBounds(!0),this.body.setSize(y.SIZE*2,y.SIZE*2),this.body.setOffset(-20,-20),this.weapons=new Map,this.unlockedWeapons=[f.PISTOL];const i=new _(t,f.PISTOL);this.weapons.set(f.PISTOL,i),this.currentWeapon=i,this.items=[],this.speedBonus=0,this.damageBonus=0,this.fireRateBonus=0,this.armor=0,this.extraBulletCount=0,this.magnetRange=0}drawPlayer(){this.clear(),this.fillStyle(m.PLAYER,1),this.lineStyle(2,m.PLAYER,1),this.beginPath(),this.moveTo(0,-20),this.lineTo(-20,y.SIZE),this.lineTo(y.SIZE,y.SIZE),this.closePath(),this.fillPath(),this.strokePath()}update(t,e){let s=0,i=0;t.left.isDown||e.a.isDown?s=-this.speed:(t.right.isDown||e.d.isDown)&&(s=this.speed),t.up.isDown||e.w.isDown?i=-this.speed:(t.down.isDown||e.s.isDown)&&(i=this.speed),s!==0&&i!==0&&(s*=.707,i*=.707),this.body.setVelocity(s,i)}aimAndRotate(t){const e=r.Math.Angle.Between(this.x,this.y,t.worldX,t.worldY);this.rotation=e+Math.PI/2}shoot(t){this.currentWeapon.fire(this.x,this.y,t.worldX,t.worldY,this.extraBulletCount)}getBullets(){return this.currentWeapon.getBullets()}switchWeapon(t){if(!this.unlockedWeapons.includes(t))return!1;if(!this.weapons.has(t)){const e=new _(this.scene,t);this.weapons.set(t,e)}return this.currentWeapon=this.weapons.get(t),!0}unlockWeapon(t){this.unlockedWeapons.includes(t)||this.unlockedWeapons.push(t)}getCurrentWeapon(){return this.currentWeapon}getUnlockedWeapons(){return this.unlockedWeapons}takeDamage(t){const e=t*(1-this.armor);this.health=Math.max(0,this.health-e),this.scene.tweens.add({targets:this,alpha:.5,duration:100,yoyo:!0,repeat:2}),this.health<=0&&this.onDeath()}pickupItem(t){this.items.push(t),this.applyItemEffect(t)}applyItemEffect(t){const e=M[t];switch(t){case E.SPEED_BOOST:this.speedBonus+=e.effect,this.speed+=e.effect;break;case E.DAMAGE_UP:this.damageBonus+=e.effect,this.damageMultiplier+=e.effect;break;case E.MAX_HP_UP:this.maxHealth+=e.effect,this.health+=e.effect;break;case E.FIRE_RATE_UP:this.fireRateBonus+=e.effect;break;case E.ARMOR:this.armor+=e.effect,this.armor=Math.min(this.armor,.5);break;case E.HEALTH_REGEN:this.health=Math.min(this.health+e.effect,this.maxHealth);break;case E.MULTI_SHOT:this.extraBulletCount+=e.effect;break;case E.MAGNET:this.magnetRange+=e.effect;break}}getItems(){return this.items}onDeath(){console.log("Player died!")}getHealthPercentage(){return this.health/this.maxHealth}gainExp(t){for(this.exp+=t;this.exp>=this.expToNextLevel;)this.levelUp()}levelUp(){this.exp-=this.expToNextLevel,this.level++,this.expToNextLevel=Math.floor(y.EXP_TO_NEXT_LEVEL_BASE*Math.pow(y.EXP_MULTIPLIER,this.level-1)),this.maxHealth+=y.LEVEL_UP_HP_GAIN,this.health=this.maxHealth,this.damageMultiplier+=y.LEVEL_UP_DAMAGE_MULTIPLIER,this.speed+=y.LEVEL_UP_SPEED_GAIN,this.showLevelUpEffect(),console.log(`Level Up! Now Level ${this.level}`)}showLevelUpEffect(){this.scene.tweens.add({targets:this,scale:1.3,alpha:.7,duration:200,yoyo:!0,repeat:2});const t=this.scene.add.text(this.x,this.y-50,"LEVEL UP!",{fontSize:"24px",color:"#00ffff",fontStyle:"bold"});t.setOrigin(.5),this.scene.tweens.add({targets:t,y:t.y-30,alpha:0,duration:1e3,onComplete:()=>{t.destroy()}})}getExpPercentage(){return this.exp/this.expToNextLevel}getCurrentDamage(){return Math.floor(this.baseDamage*this.damageMultiplier)}}class b extends r.GameObjects.Graphics{constructor(t,e,s,i,a,h){super(t),this.x=e,this.y=s,this.damage=h,this.fillStyle(m.ENEMY,1),this.fillCircle(0,0,5),t.add.existing(this),t.physics.add.existing(this),this.body.setVelocity(i,a),this.body.setCircle(5),this.lifeTimer=t.time.delayedCall(3e3,()=>{this.destroy()})}destroy(t){this.lifeTimer&&this.lifeTimer.destroy(),super.destroy(t)}}class D extends r.GameObjects.Graphics{constructor(t,e,s,i,a=u.CHASER){super(t),this.lastShootTime=0,this.x=e,this.y=s,this.player=i,this.enemyType=a;const h=I[a];this.speed=h.speed,this.health=h.health,this.maxHealth=h.health,this.damage=h.damage,this.size=h.size,this.color=h.color,this.scoreValue=h.score,a===u.SHOOTER&&(this.bullets=t.add.group({classType:b,runChildUpdate:!1})),this.drawEnemy(),t.add.existing(this),t.physics.add.existing(this),this.body.setSize(this.size*2,this.size*2),this.body.setOffset(-this.size,-this.size)}drawEnemy(){switch(this.clear(),this.fillStyle(this.color,1),this.lineStyle(2,this.color,1),this.enemyType){case u.CHASER:this.fillRect(-this.size,-this.size,this.size*2,this.size*2),this.strokeRect(-this.size,-this.size,this.size*2,this.size*2);break;case u.SHOOTER:this.drawHexagon();break;case u.SPEEDY:this.beginPath(),this.moveTo(0,-this.size),this.lineTo(-this.size,this.size),this.lineTo(this.size,this.size),this.closePath(),this.fillPath(),this.strokePath();break;case u.TANK:this.drawOctagon();break;case u.BOSS:this.drawBoss();break}}drawBoss(){this.fillCircle(0,0,this.size),this.strokeCircle(0,0,this.size),this.lineStyle(3,16776960,1),this.strokeCircle(0,0,this.size*.6),this.lineStyle(4,16776960,1),this.beginPath(),this.moveTo(-this.size*.8,0),this.lineTo(this.size*.8,0),this.moveTo(0,-this.size*.8),this.lineTo(0,this.size*.8),this.strokePath()}drawHexagon(){this.beginPath();for(let t=0;t<6;t++){const e=Math.PI/3*t,s=Math.cos(e)*this.size,i=Math.sin(e)*this.size;t===0?this.moveTo(s,i):this.lineTo(s,i)}this.closePath(),this.fillPath(),this.strokePath()}drawOctagon(){this.beginPath();for(let t=0;t<8;t++){const e=Math.PI/4*t,s=Math.cos(e)*this.size,i=Math.sin(e)*this.size;t===0?this.moveTo(s,i):this.lineTo(s,i)}this.closePath(),this.fillPath(),this.strokePath()}update(){if(!this.player||this.player.health<=0){this.body.setVelocity(0,0);return}const t=r.Math.Distance.Between(this.x,this.y,this.player.x,this.player.y),e=r.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y);switch(this.enemyType){case u.CHASER:case u.SPEEDY:case u.TANK:const s=Math.cos(e)*this.speed,i=Math.sin(e)*this.speed;this.body.setVelocity(s,i),this.rotation=e;break;case u.SHOOTER:if(t>T.SHOOT_RANGE+50){const a=Math.cos(e)*this.speed,h=Math.sin(e)*this.speed;this.body.setVelocity(a,h)}else if(t<T.SHOOT_RANGE-50){const a=-Math.cos(e)*this.speed,h=-Math.sin(e)*this.speed;this.body.setVelocity(a,h)}else this.body.setVelocity(0,0);this.rotation=e,t<=T.SHOOT_RANGE&&this.shoot();break}}shoot(){const t=this.scene.time.now;if(t-this.lastShootTime<T.SHOOT_COOLDOWN)return;this.lastShootTime=t;const e=r.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y),s=Math.cos(e)*300,i=Math.sin(e)*300,a=new b(this.scene,this.x,this.y,s,i,this.damage);this.bullets&&this.bullets.add(a)}getBullets(){return this.bullets}takeDamage(t){this.health-=t,this.scene.tweens.add({targets:this,alpha:.5,duration:50,yoyo:!0}),this.health<=0&&this.destroy()}getDamage(){return this.damage}destroy(t){this.bullets&&this.bullets.clear(!0,!0),super.destroy(t)}}class F extends r.GameObjects.Graphics{constructor(t,e,s,i){super(t),this.enemyType=u.BOSS,this.currentPhase=1,this.lastShootTime=0,this.shootCooldown=800,this.lastDashTime=0,this.dashCooldown=3e3,this.isDashing=!1,this.rotationAngle=0,this.x=e,this.y=s,this.player=i;const a=I[u.BOSS];this.speed=a.speed,this.baseSpeed=a.speed,this.health=a.health,this.maxHealth=a.health,this.damage=a.damage,this.size=a.size,this.color=a.color,this.scoreValue=a.score,this.bullets=t.add.group({classType:b,runChildUpdate:!1}),this.drawBoss(),t.add.existing(this),t.physics.add.existing(this),this.body.setSize(this.size*2,this.size*2),this.body.setOffset(-this.size,-this.size)}drawBoss(){this.clear(),this.fillStyle(this.color,1),this.lineStyle(3,this.color,1),this.fillCircle(0,0,this.size),this.strokeCircle(0,0,this.size);let t=16776960;this.currentPhase===2?t=16746496:this.currentPhase===3&&(t=16711680),this.lineStyle(3,t,1),this.strokeCircle(0,0,this.size*.6),this.lineStyle(4,t,1),this.beginPath(),this.moveTo(-this.size*.8,0),this.lineTo(this.size*.8,0),this.moveTo(0,-this.size*.8),this.lineTo(0,this.size*.8),this.strokePath()}update(){if(!this.player||this.player.health<=0){this.body.setVelocity(0,0);return}this.updatePhase();const t=r.Math.Angle.Between(this.x,this.y,this.player.x,this.player.y);switch(this.currentPhase){case 1:this.phase1Behavior(t);break;case 2:this.phase2Behavior(t);break;case 3:this.phase3Behavior(t);break}this.rotation=t,this.rotationAngle+=.02}updatePhase(){const t=this.health/this.maxHealth;let e=this.currentPhase;t>.66?e=1:t>.33?e=2:e=3,e!==this.currentPhase&&(this.currentPhase=e,this.onPhaseChange())}onPhaseChange(){this.drawBoss(),this.scene.tweens.add({targets:this,scale:1.3,duration:200,yoyo:!0,repeat:2}),this.currentPhase===2?(this.speed=this.baseSpeed*1.2,this.shootCooldown=600):this.currentPhase===3&&(this.speed=this.baseSpeed*1.5,this.shootCooldown=400)}phase1Behavior(t){const e=Math.cos(t)*this.speed,s=Math.sin(t)*this.speed;this.body.setVelocity(e,s),this.shootFan(t,3,.3)}phase2Behavior(t){const e=this.scene.time.now;if(!this.isDashing&&e-this.lastDashTime>=this.dashCooldown&&this.startDash(t),!this.isDashing){const s=Math.cos(t)*this.speed*.7,i=Math.sin(t)*this.speed*.7;this.body.setVelocity(s,i)}this.shootRotatingBullets(8)}phase3Behavior(t){const e=Math.cos(t)*this.speed,s=Math.sin(t)*this.speed;this.body.setVelocity(e,s),this.shootRotatingBullets(16)}shootFan(t,e,s){const i=this.scene.time.now;if(!(i-this.lastShootTime<this.shootCooldown)){this.lastShootTime=i;for(let a=0;a<e;a++){const h=t+s*(a-(e-1)/2),l=Math.cos(h)*300,d=Math.sin(h)*300,o=new b(this.scene,this.x,this.y,l,d,this.damage);this.bullets.add(o)}}}shootRotatingBullets(t){const e=this.scene.time.now;if(!(e-this.lastShootTime<this.shootCooldown)){this.lastShootTime=e;for(let s=0;s<t;s++){const i=this.rotationAngle+Math.PI*2/t*s,a=Math.cos(i)*250,h=Math.sin(i)*250,l=new b(this.scene,this.x,this.y,a,h,this.damage);this.bullets.add(l)}}}startDash(t){this.isDashing=!0,this.lastDashTime=this.scene.time.now;const e=this.speed*4,s=Math.cos(t)*e,i=Math.sin(t)*e;this.body.setVelocity(s,i),this.scene.tweens.add({targets:this,alpha:.5,duration:100,yoyo:!0,repeat:3}),this.scene.time.delayedCall(400,()=>{this.isDashing=!1})}getBullets(){return this.bullets}takeDamage(t){this.health-=t,this.scene.tweens.add({targets:this,alpha:.5,duration:50,yoyo:!0}),this.health<=0&&this.onDeath()}onDeath(){this.destroy()}getDamage(){return this.damage}getPhase(){return this.currentPhase}destroy(t){this.bullets&&this.bullets.clear(!0,!0),super.destroy(t)}}class v extends r.GameObjects.Graphics{constructor(t,e,s,i){super(t),this.x=e,this.y=s,this.itemType=i,this.config=M[i],this.drawItem(),t.add.existing(this),t.physics.add.existing(this),this.body.setSize(20,20),this.body.setOffset(-10,-10),t.tweens.add({targets:this,y:this.y-10,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,rotation:Math.PI*2,duration:3e3,repeat:-1,ease:"Linear"})}drawItem(){this.clear(),this.fillStyle(this.config.color,1),this.lineStyle(2,this.config.color,1),this.beginPath(),this.moveTo(0,-10),this.lineTo(10,0),this.lineTo(0,10),this.lineTo(-10,0),this.closePath(),this.fillPath(),this.strokePath(),this.fillStyle(16777215,.5),this.beginPath(),this.moveTo(0,-5),this.lineTo(5,0),this.lineTo(0,5),this.lineTo(-5,0),this.closePath(),this.fillPath()}}class O extends r.GameObjects.Graphics{constructor(t,e,s){super(t),this.x=e,this.y=s,this.value=P.CREDIT_VALUE,this.drawCredit(),t.add.existing(this),t.physics.add.existing(this),this.body.setSize(16,16),this.body.setOffset(-8,-8),t.tweens.add({targets:this,y:this.y-8,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),t.tweens.add({targets:this,scale:1.2,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}drawCredit(){this.clear(),this.fillStyle(P.CREDIT_COLOR,1),this.lineStyle(2,16755200,1),this.fillCircle(0,0,8),this.strokeCircle(0,0,8),this.fillStyle(16755200,1),this.fillCircle(0,0,4)}}class g extends r.GameObjects.Graphics{constructor(t,e,s,i,a){super(t),this.x=e,this.y=s,this.wallWidth=i,this.wallHeight=a,this.drawWall(),t.add.existing(this),t.physics.add.existing(this,!0),this.body.setSize(i,a),this.body.setOffset(-i/2,-a/2)}drawWall(){this.clear(),this.fillStyle(m.WALL,1),this.fillRect(-this.wallWidth/2,-this.wallHeight/2,this.wallWidth,this.wallHeight),this.lineStyle(2,m.WALL_OUTLINE,1),this.strokeRect(-this.wallWidth/2,-this.wallHeight/2,this.wallWidth,this.wallHeight),this.lineStyle(1,m.WALL_OUTLINE,.5),this.beginPath(),this.moveTo(-this.wallWidth/2+5,-this.wallHeight/2+5),this.lineTo(this.wallWidth/2-5,-this.wallHeight/2+5),this.strokePath()}}var A=(n=>(n.OPEN_FIELD="open_field",n.ARENA="arena",n.MAZE="maze",n))(A||{});class X{constructor(t){this.currentPattern="open_field",this.scene=t,this.walls=t.add.group()}generateMap(t,e,s){if(this.walls.clear(!0,!0),s)this.currentPattern=s;else{const i=Object.values(A);this.currentPattern=r.Utils.Array.GetRandom(i)}switch(this.currentPattern){case"open_field":this.generateOpenField(t,e);break;case"arena":this.generateArena(t,e);break;case"maze":this.generateMaze(t,e);break}return this.createBoundaryWalls(),this.walls}generateOpenField(t,e){for(let s=0;s<c.WALL_COUNT;s++){let i,a,h,l,d=0;const o=50;do if(i=r.Math.Between(100,c.WIDTH-100),a=r.Math.Between(100,c.HEIGHT-100),h=r.Math.Between(c.WALL_MIN_SIZE,c.WALL_MAX_SIZE),l=r.Math.Between(c.WALL_MIN_SIZE,c.WALL_MAX_SIZE),d++,d>=o)break;while(this.isInSafeZone(i,a,t,e));const p=new g(this.scene,i,a,h,l);this.walls.add(p)}}generateArena(t,e){for(let o=150;o<c.WIDTH-150;o+=200)if(!this.isInSafeZone(o,150,t,e)){const p=new g(this.scene,o,150,80,80);this.walls.add(p)}for(let o=150;o<c.WIDTH-150;o+=200)if(!this.isInSafeZone(o,c.HEIGHT-150,t,e)){const p=new g(this.scene,o,c.HEIGHT-150,80,80);this.walls.add(p)}for(let o=350;o<c.HEIGHT-150;o+=200)if(!this.isInSafeZone(150,o,t,e)){const p=new g(this.scene,150,o,80,80);this.walls.add(p)}for(let o=350;o<c.HEIGHT-150;o+=200)if(!this.isInSafeZone(c.WIDTH-150,o,t,e)){const p=new g(this.scene,c.WIDTH-150,o,80,80);this.walls.add(p)}const h=120,l=250,d=[{x:l,y:l},{x:c.WIDTH-l,y:l},{x:l,y:c.HEIGHT-l},{x:c.WIDTH-l,y:c.HEIGHT-l}];for(const o of d)if(!this.isInSafeZone(o.x,o.y,t,e)){const p=new g(this.scene,o.x,o.y,h,h);this.walls.add(p)}}generateMaze(t,e){for(let h=1;h<Math.floor(c.WIDTH/300);h++)for(let l=1;l<Math.floor(c.HEIGHT/300);l++){const d=h*300,o=l*300;if(!this.isInSafeZone(d,o,t,e))if(Math.random()>.5){const p=new g(this.scene,d,o,60,150);this.walls.add(p)}else{const p=new g(this.scene,d,o,150,60);this.walls.add(p)}}}getCurrentPattern(){return this.currentPattern}isInSafeZone(t,e,s,i){return r.Math.Distance.Between(t,e,s,i)<c.SAFE_ZONE_RADIUS}createBoundaryWalls(){const e=new g(this.scene,c.WIDTH/2,25,c.WIDTH,50);this.walls.add(e);const s=new g(this.scene,c.WIDTH/2,c.HEIGHT-50/2,c.WIDTH,50);this.walls.add(s);const i=new g(this.scene,50/2,c.HEIGHT/2,50,c.HEIGHT);this.walls.add(i);const a=new g(this.scene,c.WIDTH-50/2,c.HEIGHT/2,50,c.HEIGHT);this.walls.add(a)}getWalls(){return this.walls}}class Y extends r.Scene{constructor(){super({key:"GameScene"}),this.score=0,this.currentCredits=0,this.totalCredits=0,this.currentBoss=null,this.lastBossSpawnScore=0,this.difficultyLevel=1,this.lastDifficultyScore=0}create(){this.physics.world.setBounds(0,0,c.WIDTH,c.HEIGHT),this.player=new V(this,c.WIDTH/2,c.HEIGHT/2),this.mapGenerator=new X(this),this.walls=this.mapGenerator.generateMap(this.player.x,this.player.y),this.cameras.main.setBounds(0,0,c.WIDTH,c.HEIGHT),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cameras.main.setZoom(1),this.enemies=this.add.group({classType:D,runChildUpdate:!0}),this.items=this.add.group({classType:v,runChildUpdate:!1}),this.credits=this.add.group({classType:O,runChildUpdate:!1}),this.loadTotalCredits(),this.spawnEnemies(B.INITIAL_ENEMY_COUNT),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={w:this.input.keyboard.addKey(r.Input.Keyboard.KeyCodes.W),a:this.input.keyboard.addKey(r.Input.Keyboard.KeyCodes.A),s:this.input.keyboard.addKey(r.Input.Keyboard.KeyCodes.S),d:this.input.keyboard.addKey(r.Input.Keyboard.KeyCodes.D)},this.input.keyboard.on("keydown-SPACE",()=>{this.player.shoot(this.input.activePointer)}),this.input.on("pointerdown",()=>{this.player.shoot(this.input.activePointer)}),this.input.keyboard.on("keydown-ONE",()=>this.player.switchWeapon(f.PISTOL)),this.input.keyboard.on("keydown-TWO",()=>this.player.switchWeapon(f.SHOTGUN)),this.input.keyboard.on("keydown-THREE",()=>this.player.switchWeapon(f.RIFLE)),this.input.keyboard.on("keydown-FOUR",()=>this.player.switchWeapon(f.SNIPER)),this.input.keyboard.on("keydown-FIVE",()=>this.player.switchWeapon(f.LASER)),this.input.keyboard.on("keydown-SIX",()=>this.player.switchWeapon(f.BEAM)),this.input.keyboard.on("keydown-SEVEN",()=>this.player.switchWeapon(f.ROCKET_LAUNCHER)),this.player.unlockWeapon(f.SHOTGUN),this.player.unlockWeapon(f.RIFLE),this.player.unlockWeapon(f.SNIPER),this.player.unlockWeapon(f.LASER),this.player.unlockWeapon(f.BEAM),this.player.unlockWeapon(f.ROCKET_LAUNCHER),this.setupCollisions(),this.events.on("updateScore",this.updateScore,this)}update(){this.player.update(this.cursors,this.wasd),this.player.aimAndRotate(this.input.activePointer),this.enemies.getLength()<B.INITIAL_ENEMY_COUNT&&!this.currentBoss&&this.spawnEnemies(1),this.currentBoss&&this.currentBoss.active&&(this.currentBoss.update(),this.events.emit("updateBossHealth",{health:this.currentBoss.health,maxHealth:this.currentBoss.maxHealth})),this.score>=this.lastBossSpawnScore+500&&!this.currentBoss&&(this.spawnBoss(),this.lastBossSpawnScore=this.score),this.score>=this.lastDifficultyScore+200&&(this.increaseDifficulty(),this.lastDifficultyScore=this.score),this.applyMagnetEffect(),this.events.emit("updateUI",{health:this.player.health,maxHealth:this.player.maxHealth,score:this.score,level:this.player.level,exp:this.player.exp,expToNextLevel:this.player.expToNextLevel,currentWeapon:this.player.getCurrentWeapon().config.name,credits:this.currentCredits,totalCredits:this.totalCredits})}applyMagnetEffect(){if(this.player.magnetRange<=0)return;const t=50+this.player.magnetRange;this.items.getChildren().forEach(e=>{const s=e,i=r.Math.Distance.Between(this.player.x,this.player.y,s.x,s.y);if(i<t&&i>10){const a=r.Math.Angle.Between(s.x,s.y,this.player.x,this.player.y);s.x+=Math.cos(a)*5,s.y+=Math.sin(a)*5}}),this.credits.getChildren().forEach(e=>{const s=e,i=r.Math.Distance.Between(this.player.x,this.player.y,s.x,s.y);if(i<t&&i>10){const a=r.Math.Angle.Between(s.x,s.y,this.player.x,this.player.y);s.x+=Math.cos(a)*5,s.y+=Math.sin(a)*5}})}setupCollisions(){this.physics.add.collider(this.player,this.walls),this.physics.add.collider(this.enemies,this.walls),this.physics.add.collider(this.player.getBullets(),this.walls,t=>{t.destroy()}),this.physics.add.overlap(this.player.getBullets(),this.enemies,this.bulletHitEnemy,void 0,this),this.physics.add.overlap(this.player,this.enemies,this.playerHitEnemy,void 0,this),this.physics.add.overlap(this.player,this.items,this.playerPickupItem,void 0,this),this.physics.add.overlap(this.player,this.credits,this.playerPickupCredit,void 0,this)}setupEnemyBulletCollisions(t){const e=t.getBullets();e&&(this.physics.add.overlap(this.player,e,this.enemyBulletHitPlayer,void 0,this),this.physics.add.collider(e,this.walls,s=>{s.destroy()}))}bulletHitEnemy(t,e){const s=t,i=e;this.createHitEffect(i.x,i.y),this.showDamageNumber(i.x,i.y,s.damage),i.takeDamage(s.damage),s.explosionRadius>0&&this.createExplosion(s.x,s.y,s.explosionRadius,s.damage),s.onHit(),i.health<=0&&(this.score+=i.scoreValue,this.player.gainExp(i.scoreValue),this.createDeathEffect(i.x,i.y,i.enemyType),this.tryDropItem(i.x,i.y),this.tryDropCredit(i.x,i.y))}createHitEffect(t,e){const s=this.add.graphics();s.fillStyle(16777215,1),s.fillCircle(0,0,5),s.x=t,s.y=e,this.tweens.add({targets:s,scale:2,alpha:0,duration:150,onComplete:()=>{s.destroy()}})}showDamageNumber(t,e,s){const i=this.add.text(t,e-20,Math.floor(s).toString(),{fontSize:"18px",color:"#ffffff",fontStyle:"bold"});i.setOrigin(.5),this.tweens.add({targets:i,y:i.y-40,alpha:0,duration:600,onComplete:()=>{i.destroy()}})}createDeathEffect(t,e,s){var h;const a=((h=I[s])==null?void 0:h.color)||16711782;for(let l=0;l<8;l++){const d=Math.PI*2/8*l,o=this.add.graphics();o.fillStyle(a,1),o.fillCircle(0,0,4),o.x=t,o.y=e;const p=50,S=t+Math.cos(d)*p,x=e+Math.sin(d)*p;this.tweens.add({targets:o,x:S,y:x,alpha:0,scale:.5,duration:300,onComplete:()=>{o.destroy()}})}}createExplosion(t,e,s,i){const a=this.add.graphics();if(a.fillStyle(16729088,.5),a.fillCircle(0,0,s),a.lineStyle(3,16776960,1),a.strokeCircle(0,0,s),a.x=t,a.y=e,this.tweens.add({targets:a,scale:1.5,alpha:0,duration:300,onComplete:()=>{a.destroy()}}),this.enemies.getChildren().forEach(h=>{const l=h,d=r.Math.Distance.Between(t,e,l.x,l.y);if(d<s){const o=1-d/s*.5;l.takeDamage(i*o),this.showDamageNumber(l.x,l.y,i*o),l.health<=0&&(this.score+=l.scoreValue,this.player.gainExp(l.scoreValue),this.createDeathEffect(l.x,l.y,l.enemyType),this.tryDropItem(l.x,l.y),this.tryDropCredit(l.x,l.y))}}),this.currentBoss&&this.currentBoss.active){const h=r.Math.Distance.Between(t,e,this.currentBoss.x,this.currentBoss.y);if(h<s){const l=1-h/s*.5;this.currentBoss.takeDamage(i*l),this.showDamageNumber(this.currentBoss.x,this.currentBoss.y,i*l)}}this.cameras.main.shake(100,.005)}tryDropItem(t,e){const s=Object.values(E);for(const i of s){const a=M[i];if(Math.random()<a.dropChance){const h=new v(this,t,e,i);this.items.add(h);break}}}playerPickupItem(t,e){const s=e;this.player.pickupItem(s.itemType),this.tweens.add({targets:s,alpha:0,scale:1.5,duration:200,onComplete:()=>{s.destroy()}})}enemyBulletHitPlayer(t,e){const s=e;this.player.takeDamage(s.damage),s.destroy(),this.player.health<=0&&this.gameOver()}playerHitEnemy(t,e){const s=e;this.player.takeDamage(s.getDamage()),s.destroy(),this.player.health<=0&&this.gameOver()}spawnEnemies(t){const e=this.getDifficultyMultiplier();for(let s=0;s<t;s++){const i=r.Math.FloatBetween(0,Math.PI*2),a=T.SPAWN_DISTANCE,h=this.player.x+Math.cos(i)*a,l=this.player.y+Math.sin(i)*a,d=r.Math.Clamp(h,50,c.WIDTH-50),o=r.Math.Clamp(l,50,c.HEIGHT-50),p=[u.CHASER,u.SHOOTER,u.SPEEDY,u.TANK],S=r.Utils.Array.GetRandom(p),x=new D(this,d,o,this.player,S);x.health*=e.hpMultiplier,x.maxHealth*=e.hpMultiplier,this.enemies.add(x),S===u.SHOOTER&&this.setupEnemyBulletCollisions(x)}}tryDropCredit(t,e){if(Math.random()<B.CREDIT_DROP_CHANCE){const s=new O(this,t,e);this.credits.add(s)}}playerPickupCredit(t,e){const s=e;this.currentCredits+=s.value,this.totalCredits+=s.value,this.saveTotalCredits(),this.tweens.add({targets:s,y:s.y-30,alpha:0,duration:300,onComplete:()=>{s.destroy()}})}loadTotalCredits(){const t=localStorage.getItem("totalCredits");this.totalCredits=t?parseInt(t):0}saveTotalCredits(){localStorage.setItem("totalCredits",this.totalCredits.toString())}updateScore(t){this.score=t}spawnBoss(){this.walls=this.mapGenerator.generateMap(this.player.x,this.player.y,A.ARENA),this.physics.add.collider(this.player,this.walls),this.physics.add.collider(this.enemies,this.walls),this.physics.add.collider(this.player.getBullets(),this.walls,a=>{a.destroy()});const t=r.Math.FloatBetween(0,Math.PI*2),e=T.SPAWN_DISTANCE,s=r.Math.Clamp(this.player.x+Math.cos(t)*e,100,c.WIDTH-100),i=r.Math.Clamp(this.player.y+Math.sin(t)*e,100,c.HEIGHT-100);this.currentBoss=new F(this,s,i,this.player),this.setupBossBulletCollisions(),this.physics.add.overlap(this.player.getBullets(),this.currentBoss,this.bulletHitBoss,void 0,this),this.physics.add.overlap(this.player,this.currentBoss,this.playerHitBoss,void 0,this),this.physics.add.collider(this.currentBoss,this.walls),this.events.emit("bossSpawned"),this.cameras.main.shake(500,.01)}setupBossBulletCollisions(){if(!this.currentBoss)return;const t=this.currentBoss.getBullets();this.physics.add.overlap(this.player,t,this.enemyBulletHitPlayer,void 0,this),this.physics.add.collider(t,this.walls,e=>{e.destroy()})}bulletHitBoss(t,e){const s=t;!this.currentBoss||!this.currentBoss.active||(this.createHitEffect(this.currentBoss.x,this.currentBoss.y),this.showDamageNumber(this.currentBoss.x,this.currentBoss.y,s.damage),this.currentBoss.takeDamage(s.damage),s.onHit(),this.currentBoss.health<=0&&this.onBossDefeated())}playerHitBoss(t,e){!this.currentBoss||!this.currentBoss.active||(this.player.takeDamage(this.currentBoss.getDamage()),this.player.health<=0&&this.gameOver())}onBossDefeated(){if(this.currentBoss){this.score+=this.currentBoss.scoreValue,this.player.gainExp(this.currentBoss.scoreValue),this.createBossDeathEffect(this.currentBoss.x,this.currentBoss.y);for(let t=0;t<5;t++){const e=r.Math.Between(-50,50),s=r.Math.Between(-50,50);this.tryDropItem(this.currentBoss.x+e,this.currentBoss.y+s),this.tryDropCredit(this.currentBoss.x+e,this.currentBoss.y+s)}this.events.emit("bossDefeated"),this.currentBoss=null}}createBossDeathEffect(t,e){for(let i=0;i<16;i++){const a=Math.PI*2/16*i,h=this.add.graphics();h.fillStyle(16711680,1),h.fillCircle(0,0,8),h.x=t,h.y=e;const l=100,d=t+Math.cos(a)*l,o=e+Math.sin(a)*l;this.tweens.add({targets:h,x:d,y:o,alpha:0,scale:.3,duration:500,onComplete:()=>{h.destroy()}})}this.cameras.main.shake(300,.02)}increaseDifficulty(){this.difficultyLevel++,console.log(`Difficulty increased to level ${this.difficultyLevel}`)}getDifficultyMultiplier(){return{hpMultiplier:1+(this.difficultyLevel-1)*.1,speedMultiplier:1+(this.difficultyLevel-1)*.05}}gameOver(){console.log("Game Over! Final Score:",this.score),this.physics.pause();const t=this.add.text(w/2,C/2,`GAME OVER
Press R to Restart`,{fontSize:"48px",color:"#ff0066",align:"center"});t.setOrigin(.5),t.setScrollFactor(0);const e=this.add.text(w/2,C/2+80,`Score: ${this.score}`,{fontSize:"32px",color:"#00ffff",align:"center"});e.setOrigin(.5),e.setScrollFactor(0),this.input.keyboard.once("keydown-R",()=>{this.scene.restart()})}}class Z extends r.Scene{constructor(){super({key:"UIScene",active:!1}),this.bossActive=!1}create(){this.healthBarBg=this.add.graphics(),this.healthBarBg.fillStyle(m.HEALTH_BAR_BG,1),this.healthBarBg.fillRect(20,20,200,20),this.healthBar=this.add.graphics(),this.healthText=this.add.text(20,45,"HP: 100/100",{fontSize:"16px",color:"#00ffff"}),this.levelText=this.add.text(20,70,"Level: 1",{fontSize:"20px",color:"#ffff00",fontStyle:"bold"}),this.expBarBg=this.add.graphics(),this.expBarBg.fillStyle(m.HEALTH_BAR_BG,1),this.expBarBg.fillRect(20,95,200,15),this.expBar=this.add.graphics(),this.expText=this.add.text(20,115,"EXP: 0/100",{fontSize:"14px",color:"#ffff00"}),this.scoreText=this.add.text(20,140,"Score: 0",{fontSize:"20px",color:"#00ffff"}),this.weaponText=this.add.text(20,170,"Weapon: Pistol",{fontSize:"18px",color:"#00ff00",fontStyle:"bold"}),this.creditText=this.add.text(20,200,"Credits: 0",{fontSize:"16px",color:"#ffff00"}),this.totalCreditText=this.add.text(20,220,"Total Credits: 0",{fontSize:"14px",color:"#ffaa00"}),this.add.text(20,250,"WASD: Move | Mouse: Aim | Space/Click: Shoot | 1-7: Weapon",{fontSize:"14px",color:"#666666"}),this.bossHealthBarBg=this.add.graphics(),this.bossHealthBarBg.fillStyle(m.HEALTH_BAR_BG,1),this.bossHealthBarBg.fillRect(w/2-200,50,400,25),this.bossHealthBarBg.setVisible(!1),this.bossHealthBar=this.add.graphics(),this.bossHealthBar.setVisible(!1),this.bossNameText=this.add.text(w/2,30,"CYBER GUARDIAN",{fontSize:"24px",color:"#ff0000",fontStyle:"bold"}),this.bossNameText.setOrigin(.5),this.bossNameText.setVisible(!1),this.warningText=this.add.text(w/2,200,"WARNING",{fontSize:"64px",color:"#ff0000",fontStyle:"bold"}),this.warningText.setOrigin(.5),this.warningText.setVisible(!1);const t=this.scene.get("GameScene");t.events.on("updateUI",this.updateUI,this),t.events.on("bossSpawned",this.onBossSpawned,this),t.events.on("bossDefeated",this.onBossDefeated,this),t.events.on("updateBossHealth",this.updateBossHealth,this)}updateUI(t){const e=t.health/t.maxHealth;this.healthBar.clear(),this.healthBar.fillStyle(m.HEALTH_BAR,1),this.healthBar.fillRect(20,20,200*e,20),this.healthText.setText(`HP: ${Math.max(0,Math.floor(t.health))}/${t.maxHealth}`),this.levelText.setText(`Level: ${t.level}`);const s=t.exp/t.expToNextLevel;this.expBar.clear(),this.expBar.fillStyle(16776960,1),this.expBar.fillRect(20,95,200*s,15),this.expText.setText(`EXP: ${Math.floor(t.exp)}/${t.expToNextLevel}`),this.scoreText.setText(`Score: ${t.score}`),this.weaponText.setText(`Weapon: ${t.currentWeapon}`),this.creditText.setText(`Credits: ${t.credits}`),this.totalCreditText.setText(`Total Credits: ${t.totalCredits}`)}onBossSpawned(){this.bossActive=!0,this.warningText.setVisible(!0),this.warningText.setAlpha(1),this.tweens.add({targets:this.warningText,alpha:0,duration:200,yoyo:!0,repeat:5,onComplete:()=>{this.warningText.setVisible(!1)}}),this.cameras.main.shake(500,.01),this.time.delayedCall(1500,()=>{this.bossHealthBarBg.setVisible(!0),this.bossHealthBar.setVisible(!0),this.bossNameText.setVisible(!0)})}onBossDefeated(){this.bossActive=!1,this.bossHealthBarBg.setVisible(!1),this.bossHealthBar.setVisible(!1),this.bossNameText.setVisible(!1)}updateBossHealth(t){if(!this.bossActive)return;const e=t.health/t.maxHealth;this.bossHealthBar.clear();let s=16711680;e>.66?s=16711680:e>.33?s=16746496:s=16776960,this.bossHealthBar.fillStyle(s,1),this.bossHealthBar.fillRect(w/2-200,50,400*e,25)}}const K={type:r.AUTO,width:w,height:C,parent:"game-container",backgroundColor:m.BACKGROUND,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:B.DEBUG_MODE}},scene:[G,Y,Z],scale:{mode:r.Scale.FIT,autoCenter:r.Scale.CENTER_BOTH}};new r.Game(K);console.log("サイバーパンク・ローグライトシューター - 起動");console.log("Phaser version:",r.VERSION);
